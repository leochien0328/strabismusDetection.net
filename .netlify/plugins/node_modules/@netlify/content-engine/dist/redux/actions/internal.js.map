{"version":3,"file":"internal.js","names":["_reporter","_interopRequireDefault","require","_joi","_didYouMean","_manager","_engineContext","createPageDependencies","payload","plugin","type","map","path","nodeId","connection","exports","createPageDependency","deleteComponentsDependencies","paths","replaceComponentQuery","query","componentPath","apiFinished","replaceStaticQuery","args","queryExtracted","traceId","setGraphQLDefinitions","definitionsByName","queryExtractionGraphQLError","error","queryExtractedBabelSuccess","queryExtractionBabelError","setProgramStatus","status","pageQueryRun","queryStart","isPage","clearDirtyQueriesListToEmitViaWebsocket","removeStaleJob","contentDigest","setSiteConfig","config","result","gatsbyConfigSchema","validate","normalizedPayload","value","hasUnknownKeys","details","filter","Array","isArray","length","errorMessages","unknown","context","message","key","suggestion","didYouMean","reporter","panic","id","sourceMessage","join","createJobV2FromInternalJob","internalJob","dispatch","getState","_engineContext$reques","jobContentDigest","currentState","jobsV2","complete","has","Promise","resolve","get","engineContext","getEngineContext","job","requestId","inProgressJobPromise","getInProcessJobPromise","name","enqueuedJobPromise","enqueueJob","then","removeInProgressJob","clearGatsbyImageSourceUrls"],"sources":["../../../src/redux/actions/internal.ts"],"sourcesContent":["import reporter from \"../../reporter\";\n\nimport {\n  IGatsbyConfig,\n  IGatsbyPlugin,\n  ProgramStatus,\n  ICreatePageDependencyAction,\n  IDeleteComponentDependenciesAction,\n  IReplaceComponentQueryAction,\n  IReplaceStaticQueryAction,\n  IQueryExtractedAction,\n  IQueryExtractionGraphQLErrorAction,\n  IQueryExtractedBabelSuccessAction,\n  IQueryExtractionBabelErrorAction,\n  ISetProgramStatusAction,\n  IPageQueryRunAction,\n  IRemoveStaleJobAction,\n  ISetSiteConfig,\n  IDefinitionMeta,\n  ISetGraphQLDefinitionsAction,\n  IQueryStartAction,\n  IApiFinishedAction,\n  IQueryClearDirtyQueriesListToEmitViaWebsocket,\n  ICreateJobV2FromInternalAction,\n  ICreatePageDependencyActionPayloadType,\n  IClearGatsbyImageSourceUrlAction,\n} from \"../types\";\n\nimport { gatsbyConfigSchema } from \"../../joi-schemas/joi\";\nimport { didYouMean } from \"../../utils/did-you-mean\";\nimport {\n  enqueueJob,\n  InternalJob,\n  removeInProgressJob,\n  getInProcessJobPromise,\n} from \"../../utils/jobs/manager\";\nimport { getEngineContext } from \"../../utils/engine-context\";\n\n/**\n * Create a dependency between a page and data. Probably for\n * internal use only.\n * @private\n */\nexport const createPageDependencies = (\n  payload: Array<ICreatePageDependencyActionPayloadType>,\n  plugin = ``,\n): ICreatePageDependencyAction => {\n  return {\n    type: `CREATE_COMPONENT_DEPENDENCY`,\n    plugin,\n    payload: payload.map(({ path, nodeId, connection }) => {\n      return {\n        path,\n        nodeId,\n        connection,\n      };\n    }),\n  };\n};\n\n/**\n * Create a dependency between a page and data. Probably for\n * internal use only.\n *\n * Shorthand for createPageDependencies.\n * @private\n */\nexport const createPageDependency = (\n  payload: ICreatePageDependencyActionPayloadType,\n  plugin = ``,\n): ICreatePageDependencyAction => createPageDependencies([payload], plugin);\n\n/**\n * Delete dependencies between an array of pages and data. Probably for\n * internal use only. Used when deleting pages.\n * @private\n */\nexport const deleteComponentsDependencies = (\n  paths: Array<string>,\n): IDeleteComponentDependenciesAction => {\n  return {\n    type: `DELETE_COMPONENTS_DEPENDENCIES`,\n    payload: {\n      paths,\n    },\n  };\n};\n\n/**\n * When the query watcher extracts a GraphQL query, it calls\n * this to store the query with its component.\n * @private\n */\nexport const replaceComponentQuery = ({\n  query,\n  componentPath,\n}: {\n  query: string;\n  componentPath: string;\n}): IReplaceComponentQueryAction => {\n  return {\n    type: `REPLACE_COMPONENT_QUERY`,\n    payload: {\n      query,\n      componentPath,\n    },\n  };\n};\n\nexport const apiFinished = (\n  payload: IApiFinishedAction[\"payload\"],\n): IApiFinishedAction => {\n  return {\n    type: `API_FINISHED`,\n    payload,\n  };\n};\n\n/**\n * When the query watcher extracts a \"static\" GraphQL query from useStaticQuery\n * it calls this to store the query with its component.\n * @private\n */\nexport const replaceStaticQuery = (\n  args: {\n    name: string;\n    componentPath: string;\n    id: string;\n    query: string;\n    hash: string;\n  },\n  plugin: IGatsbyPlugin | null | undefined = null,\n): IReplaceStaticQueryAction => {\n  return {\n    type: `REPLACE_STATIC_QUERY`,\n    plugin,\n    payload: args,\n  };\n};\n\n/**\n *\n * Report that a query has been extracted from a component. Used by\n * query-compiler.js.\n * @private\n */\nexport const queryExtracted = (\n  { componentPath, query }: { componentPath: string; query: string },\n  plugin: IGatsbyPlugin,\n  traceId?: string,\n): IQueryExtractedAction => {\n  return {\n    type: `QUERY_EXTRACTED`,\n    plugin,\n    traceId,\n    payload: { componentPath, query },\n  };\n};\n\n/**\n * Set Definitions for fragment extraction, etc.\n *\n * Used by developer tools such as vscode-graphql & graphiql\n *\n * query-compiler.js.\n * @private\n */\nexport const setGraphQLDefinitions = (\n  definitionsByName: Map<string, IDefinitionMeta>,\n): ISetGraphQLDefinitionsAction => {\n  return {\n    type: `SET_GRAPHQL_DEFINITIONS`,\n    payload: definitionsByName,\n  };\n};\n\n/**\n *\n * Report that the Relay Compiler found a graphql error when attempting to extract a query\n * @private\n */\nexport const queryExtractionGraphQLError = (\n  { componentPath, error }: { componentPath: string; error: string },\n  plugin: IGatsbyPlugin,\n  traceId?: string,\n): IQueryExtractionGraphQLErrorAction => {\n  return {\n    type: `QUERY_EXTRACTION_GRAPHQL_ERROR`,\n    plugin,\n    traceId,\n    payload: { componentPath, error },\n  };\n};\n\n/**\n *\n * Report that babel was able to extract the graphql query.\n * Indicates that the file is free of JS errors.\n * @private\n */\nexport const queryExtractedBabelSuccess = (\n  { componentPath },\n  plugin: IGatsbyPlugin,\n  traceId?: string,\n): IQueryExtractedBabelSuccessAction => {\n  return {\n    type: `QUERY_EXTRACTION_BABEL_SUCCESS`,\n    plugin,\n    traceId,\n    payload: { componentPath },\n  };\n};\n\n/**\n *\n * Report that the Relay Compiler found a babel error when attempting to extract a query\n * @private\n */\nexport const queryExtractionBabelError = (\n  { componentPath, error }: { componentPath: string; error: Error },\n  plugin: IGatsbyPlugin,\n  traceId?: string,\n): IQueryExtractionBabelErrorAction => {\n  return {\n    type: `QUERY_EXTRACTION_BABEL_ERROR`,\n    plugin,\n    traceId,\n    payload: { componentPath, error },\n  };\n};\n\n/**\n * Set overall program status e.g. `BOOTSTRAPING` or `BOOTSTRAP_FINISHED`.\n * @private\n */\nexport const setProgramStatus = (\n  status: ProgramStatus,\n  plugin: IGatsbyPlugin,\n  traceId?: string,\n): ISetProgramStatusAction => {\n  return {\n    type: `SET_PROGRAM_STATUS`,\n    plugin,\n    traceId,\n    payload: status,\n  };\n};\n\n/**\n * Broadcast that a page's query was run.\n * @private\n */\nexport const pageQueryRun = (\n  payload: IPageQueryRunAction[\"payload\"],\n  plugin: IGatsbyPlugin,\n  traceId?: string,\n): IPageQueryRunAction => {\n  return {\n    type: `PAGE_QUERY_RUN`,\n    plugin,\n    traceId,\n    payload,\n  };\n};\n\nexport const queryStart = (\n  { path, componentPath, isPage },\n  plugin: IGatsbyPlugin,\n  traceId?: string,\n): IQueryStartAction => {\n  return {\n    type: `QUERY_START`,\n    plugin,\n    traceId,\n    payload: { path, componentPath, isPage },\n  };\n};\n\nexport const clearDirtyQueriesListToEmitViaWebsocket =\n  (): IQueryClearDirtyQueriesListToEmitViaWebsocket => {\n    return {\n      type: `QUERY_CLEAR_DIRTY_QUERIES_LIST_TO_EMIT_VIA_WEBSOCKET`,\n    };\n  };\n\n/**\n * Remove jobs which are marked as stale (inputPath doesn't exists)\n * @private\n */\nexport const removeStaleJob = (\n  contentDigest: string,\n  plugin?: IGatsbyPlugin,\n  traceId?: string,\n): IRemoveStaleJobAction => {\n  return {\n    type: `REMOVE_STALE_JOB_V2`,\n    plugin,\n    traceId,\n    payload: {\n      contentDigest,\n    },\n  };\n};\n\n/**\n * Set gatsby config\n * @private\n */\nexport const setSiteConfig = (config?: unknown): ISetSiteConfig => {\n  const result = gatsbyConfigSchema.validate(config || {});\n  const normalizedPayload = result.value as IGatsbyConfig;\n\n  if (result.error) {\n    const hasUnknownKeys = result.error.details.filter(\n      (details) => details.type === `object.unknown`,\n    );\n\n    if (Array.isArray(hasUnknownKeys) && hasUnknownKeys.length) {\n      const errorMessages = hasUnknownKeys.map((unknown) => {\n        const { context, message } = unknown;\n        const key = context?.key;\n        const suggestion = key && didYouMean(key);\n\n        if (suggestion) {\n          return `${message}. ${suggestion}`;\n        }\n\n        return message;\n      });\n\n      reporter.panic({\n        id: `10122`,\n        context: {\n          sourceMessage: errorMessages.join(`\\n`),\n        },\n      });\n    }\n\n    reporter.panic({\n      id: `10122`,\n      context: {\n        sourceMessage: result.error.message,\n      },\n    });\n  }\n\n  return {\n    type: `SET_SITE_CONFIG`,\n    // payload: config,\n    payload: normalizedPayload,\n  };\n};\n\nexport const createJobV2FromInternalJob =\n  (internalJob: InternalJob): ICreateJobV2FromInternalAction =>\n  (dispatch, getState): Promise<Record<string, unknown>> => {\n    const jobContentDigest = internalJob.contentDigest;\n    const currentState = getState();\n\n    // Check if we already ran this job before, if yes we return the result\n    // We have an inflight (in progress) queue inside the jobs manager to make sure\n    // we don't waste resources twice during the process\n    if (\n      currentState.jobsV2 &&\n      currentState.jobsV2.complete.has(jobContentDigest)\n    ) {\n      return Promise.resolve(\n        currentState.jobsV2.complete.get(jobContentDigest)!.result,\n      );\n    }\n    const engineContext = getEngineContext();\n\n    // Always set context, even if engineContext is undefined.\n    // We do this because the final list of jobs for a given engine request includes both:\n    //  - jobs with the same requestId\n    //  - jobs without requestId (technically with requestId === \"\")\n    //\n    // See https://nodejs.org/dist/latest-v16.x/docs/api/async_context.html#async_context_troubleshooting_context_loss\n    // on cases when async context could be lost.\n    dispatch({\n      type: `SET_JOB_V2_CONTEXT`,\n      payload: {\n        job: internalJob,\n        requestId: engineContext?.requestId ?? ``,\n      },\n    });\n\n    const inProgressJobPromise = getInProcessJobPromise(jobContentDigest);\n    if (inProgressJobPromise) {\n      return inProgressJobPromise;\n    }\n\n    dispatch({\n      type: `CREATE_JOB_V2`,\n      payload: {\n        job: internalJob,\n      },\n      plugin: { name: internalJob.plugin.name },\n    });\n\n    const enqueuedJobPromise = enqueueJob(internalJob);\n    return enqueuedJobPromise.then((result) => {\n      // store the result in redux so we have it for the next run\n      dispatch({\n        type: `END_JOB_V2`,\n        plugin: { name: internalJob.plugin.name },\n        payload: {\n          jobContentDigest,\n          result,\n        },\n      });\n\n      // remove the job from our inProgressJobQueue as it's available in our done state.\n      // this is a perf optimisations so we don't grow our memory too much when using gatsby preview\n      removeInProgressJob(jobContentDigest);\n\n      return result;\n    });\n  };\n\nexport const clearGatsbyImageSourceUrls =\n  (): IClearGatsbyImageSourceUrlAction => {\n    return {\n      type: `CLEAR_GATSBY_IMAGE_SOURCE_URL`,\n    };\n  };\n"],"mappings":";;;;;AAAA,IAAAA,SAAA,GAAAC,sBAAA,CAAAC,OAAA;AA4BA,IAAAC,IAAA,GAAAD,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AACA,IAAAG,QAAA,GAAAH,OAAA;AAMA,IAAAI,cAAA,GAAAJ,OAAA;AAEA;AACA;AACA;AACA;AACA;AACO,MAAMK,sBAAsB,GAAGA,CACpCC,OAAsD,EACtDC,MAAM,GAAI,EAAC,KACqB;EAChC,OAAO;IACLC,IAAI,EAAG,6BAA4B;IACnCD,MAAM;IACND,OAAO,EAAEA,OAAO,CAACG,GAAG,CAAC,CAAC;MAAEC,IAAI;MAAEC,MAAM;MAAEC;IAAW,CAAC,KAAK;MACrD,OAAO;QACLF,IAAI;QACJC,MAAM;QACNC;MACF,CAAC;IACH,CAAC;EACH,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AANAC,OAAA,CAAAR,sBAAA,GAAAA,sBAAA;AAOO,MAAMS,oBAAoB,GAAGA,CAClCR,OAA+C,EAC/CC,MAAM,GAAI,EAAC,KACqBF,sBAAsB,CAAC,CAACC,OAAO,CAAC,EAAEC,MAAM,CAAC;;AAE3E;AACA;AACA;AACA;AACA;AAJAM,OAAA,CAAAC,oBAAA,GAAAA,oBAAA;AAKO,MAAMC,4BAA4B,GACvCC,KAAoB,IACmB;EACvC,OAAO;IACLR,IAAI,EAAG,gCAA+B;IACtCF,OAAO,EAAE;MACPU;IACF;EACF,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AAJAH,OAAA,CAAAE,4BAAA,GAAAA,4BAAA;AAKO,MAAME,qBAAqB,GAAGA,CAAC;EACpCC,KAAK;EACLC;AAIF,CAAC,KAAmC;EAClC,OAAO;IACLX,IAAI,EAAG,yBAAwB;IAC/BF,OAAO,EAAE;MACPY,KAAK;MACLC;IACF;EACF,CAAC;AACH,CAAC;AAACN,OAAA,CAAAI,qBAAA,GAAAA,qBAAA;AAEK,MAAMG,WAAW,GACtBd,OAAsC,IACf;EACvB,OAAO;IACLE,IAAI,EAAG,cAAa;IACpBF;EACF,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AAJAO,OAAA,CAAAO,WAAA,GAAAA,WAAA;AAKO,MAAMC,kBAAkB,GAAGA,CAChCC,IAMC,EACDf,MAAwC,GAAG,IAAI,KACjB;EAC9B,OAAO;IACLC,IAAI,EAAG,sBAAqB;IAC5BD,MAAM;IACND,OAAO,EAAEgB;EACX,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AALAT,OAAA,CAAAQ,kBAAA,GAAAA,kBAAA;AAMO,MAAME,cAAc,GAAGA,CAC5B;EAAEJ,aAAa;EAAED;AAAgD,CAAC,EAClEX,MAAqB,EACrBiB,OAAgB,KACU;EAC1B,OAAO;IACLhB,IAAI,EAAG,iBAAgB;IACvBD,MAAM;IACNiB,OAAO;IACPlB,OAAO,EAAE;MAAEa,aAAa;MAAED;IAAM;EAClC,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPAL,OAAA,CAAAU,cAAA,GAAAA,cAAA;AAQO,MAAME,qBAAqB,GAChCC,iBAA+C,IACd;EACjC,OAAO;IACLlB,IAAI,EAAG,yBAAwB;IAC/BF,OAAO,EAAEoB;EACX,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AAJAb,OAAA,CAAAY,qBAAA,GAAAA,qBAAA;AAKO,MAAME,2BAA2B,GAAGA,CACzC;EAAER,aAAa;EAAES;AAAgD,CAAC,EAClErB,MAAqB,EACrBiB,OAAgB,KACuB;EACvC,OAAO;IACLhB,IAAI,EAAG,gCAA+B;IACtCD,MAAM;IACNiB,OAAO;IACPlB,OAAO,EAAE;MAAEa,aAAa;MAAES;IAAM;EAClC,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AALAf,OAAA,CAAAc,2BAAA,GAAAA,2BAAA;AAMO,MAAME,0BAA0B,GAAGA,CACxC;EAAEV;AAAc,CAAC,EACjBZ,MAAqB,EACrBiB,OAAgB,KACsB;EACtC,OAAO;IACLhB,IAAI,EAAG,gCAA+B;IACtCD,MAAM;IACNiB,OAAO;IACPlB,OAAO,EAAE;MAAEa;IAAc;EAC3B,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AAJAN,OAAA,CAAAgB,0BAAA,GAAAA,0BAAA;AAKO,MAAMC,yBAAyB,GAAGA,CACvC;EAAEX,aAAa;EAAES;AAA+C,CAAC,EACjErB,MAAqB,EACrBiB,OAAgB,KACqB;EACrC,OAAO;IACLhB,IAAI,EAAG,8BAA6B;IACpCD,MAAM;IACNiB,OAAO;IACPlB,OAAO,EAAE;MAAEa,aAAa;MAAES;IAAM;EAClC,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AAHAf,OAAA,CAAAiB,yBAAA,GAAAA,yBAAA;AAIO,MAAMC,gBAAgB,GAAGA,CAC9BC,MAAqB,EACrBzB,MAAqB,EACrBiB,OAAgB,KACY;EAC5B,OAAO;IACLhB,IAAI,EAAG,oBAAmB;IAC1BD,MAAM;IACNiB,OAAO;IACPlB,OAAO,EAAE0B;EACX,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AAHAnB,OAAA,CAAAkB,gBAAA,GAAAA,gBAAA;AAIO,MAAME,YAAY,GAAGA,CAC1B3B,OAAuC,EACvCC,MAAqB,EACrBiB,OAAgB,KACQ;EACxB,OAAO;IACLhB,IAAI,EAAG,gBAAe;IACtBD,MAAM;IACNiB,OAAO;IACPlB;EACF,CAAC;AACH,CAAC;AAACO,OAAA,CAAAoB,YAAA,GAAAA,YAAA;AAEK,MAAMC,UAAU,GAAGA,CACxB;EAAExB,IAAI;EAAES,aAAa;EAAEgB;AAAO,CAAC,EAC/B5B,MAAqB,EACrBiB,OAAgB,KACM;EACtB,OAAO;IACLhB,IAAI,EAAG,aAAY;IACnBD,MAAM;IACNiB,OAAO;IACPlB,OAAO,EAAE;MAAEI,IAAI;MAAES,aAAa;MAAEgB;IAAO;EACzC,CAAC;AACH,CAAC;AAACtB,OAAA,CAAAqB,UAAA,GAAAA,UAAA;AAEK,MAAME,uCAAuC,GAClDA,CAAA,KAAqD;EACnD,OAAO;IACL5B,IAAI,EAAG;EACT,CAAC;AACH,CAAC;;AAEH;AACA;AACA;AACA;AAHAK,OAAA,CAAAuB,uCAAA,GAAAA,uCAAA;AAIO,MAAMC,cAAc,GAAGA,CAC5BC,aAAqB,EACrB/B,MAAsB,EACtBiB,OAAgB,KACU;EAC1B,OAAO;IACLhB,IAAI,EAAG,qBAAoB;IAC3BD,MAAM;IACNiB,OAAO;IACPlB,OAAO,EAAE;MACPgC;IACF;EACF,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AAHAzB,OAAA,CAAAwB,cAAA,GAAAA,cAAA;AAIO,MAAME,aAAa,GAAIC,MAAgB,IAAqB;EACjE,MAAMC,MAAM,GAAGC,uBAAkB,CAACC,QAAQ,CAACH,MAAM,IAAI,CAAC,CAAC,CAAC;EACxD,MAAMI,iBAAiB,GAAGH,MAAM,CAACI,KAAsB;EAEvD,IAAIJ,MAAM,CAACb,KAAK,EAAE;IAChB,MAAMkB,cAAc,GAAGL,MAAM,CAACb,KAAK,CAACmB,OAAO,CAACC,MAAM,CAC/CD,OAAO,IAAKA,OAAO,CAACvC,IAAI,KAAM,gBACjC,CAAC;IAED,IAAIyC,KAAK,CAACC,OAAO,CAACJ,cAAc,CAAC,IAAIA,cAAc,CAACK,MAAM,EAAE;MAC1D,MAAMC,aAAa,GAAGN,cAAc,CAACrC,GAAG,CAAE4C,OAAO,IAAK;QACpD,MAAM;UAAEC,OAAO;UAAEC;QAAQ,CAAC,GAAGF,OAAO;QACpC,MAAMG,GAAG,GAAGF,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEE,GAAG;QACxB,MAAMC,UAAU,GAAGD,GAAG,IAAI,IAAAE,sBAAU,EAACF,GAAG,CAAC;QAEzC,IAAIC,UAAU,EAAE;UACd,OAAQ,GAAEF,OAAQ,KAAIE,UAAW,EAAC;QACpC;QAEA,OAAOF,OAAO;MAChB,CAAC,CAAC;MAEFI,iBAAQ,CAACC,KAAK,CAAC;QACbC,EAAE,EAAG,OAAM;QACXP,OAAO,EAAE;UACPQ,aAAa,EAAEV,aAAa,CAACW,IAAI,CAAE,IAAG;QACxC;MACF,CAAC,CAAC;IACJ;IAEAJ,iBAAQ,CAACC,KAAK,CAAC;MACbC,EAAE,EAAG,OAAM;MACXP,OAAO,EAAE;QACPQ,aAAa,EAAErB,MAAM,CAACb,KAAK,CAAC2B;MAC9B;IACF,CAAC,CAAC;EACJ;EAEA,OAAO;IACL/C,IAAI,EAAG,iBAAgB;IACvB;IACAF,OAAO,EAAEsC;EACX,CAAC;AACH,CAAC;AAAC/B,OAAA,CAAA0B,aAAA,GAAAA,aAAA;AAEK,MAAMyB,0BAA0B,GACpCC,WAAwB,IACzB,CAACC,QAAQ,EAAEC,QAAQ,KAAuC;EAAA,IAAAC,qBAAA;EACxD,MAAMC,gBAAgB,GAAGJ,WAAW,CAAC3B,aAAa;EAClD,MAAMgC,YAAY,GAAGH,QAAQ,CAAC,CAAC;;EAE/B;EACA;EACA;EACA,IACEG,YAAY,CAACC,MAAM,IACnBD,YAAY,CAACC,MAAM,CAACC,QAAQ,CAACC,GAAG,CAACJ,gBAAgB,CAAC,EAClD;IACA,OAAOK,OAAO,CAACC,OAAO,CACpBL,YAAY,CAACC,MAAM,CAACC,QAAQ,CAACI,GAAG,CAACP,gBAAgB,CAAC,CAAE5B,MACtD,CAAC;EACH;EACA,MAAMoC,aAAa,GAAG,IAAAC,+BAAgB,EAAC,CAAC;;EAExC;EACA;EACA;EACA;EACA;EACA;EACA;EACAZ,QAAQ,CAAC;IACP1D,IAAI,EAAG,oBAAmB;IAC1BF,OAAO,EAAE;MACPyE,GAAG,EAAEd,WAAW;MAChBe,SAAS,GAAAZ,qBAAA,GAAES,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEG,SAAS,cAAAZ,qBAAA,cAAAA,qBAAA,GAAK;IAC1C;EACF,CAAC,CAAC;EAEF,MAAMa,oBAAoB,GAAG,IAAAC,+BAAsB,EAACb,gBAAgB,CAAC;EACrE,IAAIY,oBAAoB,EAAE;IACxB,OAAOA,oBAAoB;EAC7B;EAEAf,QAAQ,CAAC;IACP1D,IAAI,EAAG,eAAc;IACrBF,OAAO,EAAE;MACPyE,GAAG,EAAEd;IACP,CAAC;IACD1D,MAAM,EAAE;MAAE4E,IAAI,EAAElB,WAAW,CAAC1D,MAAM,CAAC4E;IAAK;EAC1C,CAAC,CAAC;EAEF,MAAMC,kBAAkB,GAAG,IAAAC,mBAAU,EAACpB,WAAW,CAAC;EAClD,OAAOmB,kBAAkB,CAACE,IAAI,CAAE7C,MAAM,IAAK;IACzC;IACAyB,QAAQ,CAAC;MACP1D,IAAI,EAAG,YAAW;MAClBD,MAAM,EAAE;QAAE4E,IAAI,EAAElB,WAAW,CAAC1D,MAAM,CAAC4E;MAAK,CAAC;MACzC7E,OAAO,EAAE;QACP+D,gBAAgB;QAChB5B;MACF;IACF,CAAC,CAAC;;IAEF;IACA;IACA,IAAA8C,4BAAmB,EAAClB,gBAAgB,CAAC;IAErC,OAAO5B,MAAM;EACf,CAAC,CAAC;AACJ,CAAC;AAAC5B,OAAA,CAAAmD,0BAAA,GAAAA,0BAAA;AAEG,MAAMwB,0BAA0B,GACrCA,CAAA,KAAwC;EACtC,OAAO;IACLhF,IAAI,EAAG;EACT,CAAC;AACH,CAAC;AAACK,OAAA,CAAA2E,0BAAA,GAAAA,0BAAA"}