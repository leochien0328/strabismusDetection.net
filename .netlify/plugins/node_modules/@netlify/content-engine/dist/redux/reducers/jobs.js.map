{"version":3,"file":"jobs.js","names":["_commonTags","require","_moment","_interopRequireDefault","jobsReducer","state","active","done","action","type","payload","id","Error","index","_findIndex2","default","j","mergedJob","_merge2","createdAt","Date","now","plugin","push","completedAt","oneLine","_get2","job","splice","runTime","moment","diff","exports"],"sources":["../../../src/redux/reducers/jobs.ts"],"sourcesContent":["import _ from \"lodash\";\nimport { oneLine } from \"common-tags\";\nimport moment from \"moment\";\n\nimport { IGatsbyState, ActionsUnion } from \"../types\";\n\nexport const jobsReducer = (\n  state: IGatsbyState[\"jobs\"] = { active: [], done: [] },\n  action: ActionsUnion,\n): IGatsbyState[\"jobs\"] => {\n  switch (action.type) {\n    case `CREATE_JOB`:\n    case `SET_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when creating or setting job`);\n      }\n      const index = _.findIndex(\n        state.active,\n        (j) => j.id === action.payload.id,\n      );\n      if (index !== -1) {\n        const mergedJob = _.merge(state.active[index], {\n          ...action.payload,\n          createdAt: Date.now(),\n          plugin: action.plugin,\n        });\n\n        state.active[index] = mergedJob;\n        return state;\n      } else {\n        state.active.push({\n          ...action.payload,\n          createdAt: Date.now(),\n          plugin: action.plugin,\n        });\n        return state;\n      }\n    }\n    case `END_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when ending a job`);\n      }\n      const completedAt = Date.now();\n      const index = _.findIndex(\n        state.active,\n        (j) => j.id === action.payload.id,\n      );\n      if (index === -1) {\n        throw new Error(oneLine`\n          The plugin \"${_.get(action, `plugin.name`, `anonymous`)}\"\n          tried to end a job with the id \"${action.payload.id}\"\n          that either hasn't yet been created or has already been ended`);\n      }\n      const job = state.active.splice(index, 1)[0];\n      state.done.push({\n        ...job,\n        completedAt,\n        runTime: moment(completedAt).diff(moment(job.createdAt)),\n      });\n\n      return state;\n    }\n  }\n\n  return state;\n};\n"],"mappings":";;;;;;;;AACA,IAAAA,WAAA,GAAAC,OAAA;AACA,IAAAC,OAAA,GAAAC,sBAAA,CAAAF,OAAA;AAIO,MAAMG,WAAW,GAAGA,CACzBC,KAA2B,GAAG;EAAEC,MAAM,EAAE,EAAE;EAAEC,IAAI,EAAE;AAAG,CAAC,EACtDC,MAAoB,KACK;EACzB,QAAQA,MAAM,CAACC,IAAI;IACjB,KAAM,YAAW;IACjB,KAAM,SAAQ;MAAE;QACd,IAAI,CAACD,MAAM,CAACE,OAAO,CAACC,EAAE,EAAE;UACtB,MAAM,IAAIC,KAAK,CAAE,qDAAoD,CAAC;QACxE;QACA,MAAMC,KAAK,GAAG,IAAAC,WAAA,CAAAC,OAAA,EACZV,KAAK,CAACC,MAAM,EACXU,CAAC,IAAKA,CAAC,CAACL,EAAE,KAAKH,MAAM,CAACE,OAAO,CAACC,EACjC,CAAC;QACD,IAAIE,KAAK,KAAK,CAAC,CAAC,EAAE;UAChB,MAAMI,SAAS,GAAG,IAAAC,OAAA,CAAAH,OAAA,EAAQV,KAAK,CAACC,MAAM,CAACO,KAAK,CAAC,EAAE;YAC7C,GAAGL,MAAM,CAACE,OAAO;YACjBS,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC;YACrBC,MAAM,EAAEd,MAAM,CAACc;UACjB,CAAC,CAAC;UAEFjB,KAAK,CAACC,MAAM,CAACO,KAAK,CAAC,GAAGI,SAAS;UAC/B,OAAOZ,KAAK;QACd,CAAC,MAAM;UACLA,KAAK,CAACC,MAAM,CAACiB,IAAI,CAAC;YAChB,GAAGf,MAAM,CAACE,OAAO;YACjBS,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC;YACrBC,MAAM,EAAEd,MAAM,CAACc;UACjB,CAAC,CAAC;UACF,OAAOjB,KAAK;QACd;MACF;IACA,KAAM,SAAQ;MAAE;QACd,IAAI,CAACG,MAAM,CAACE,OAAO,CAACC,EAAE,EAAE;UACtB,MAAM,IAAIC,KAAK,CAAE,0CAAyC,CAAC;QAC7D;QACA,MAAMY,WAAW,GAAGJ,IAAI,CAACC,GAAG,CAAC,CAAC;QAC9B,MAAMR,KAAK,GAAG,IAAAC,WAAA,CAAAC,OAAA,EACZV,KAAK,CAACC,MAAM,EACXU,CAAC,IAAKA,CAAC,CAACL,EAAE,KAAKH,MAAM,CAACE,OAAO,CAACC,EACjC,CAAC;QACD,IAAIE,KAAK,KAAK,CAAC,CAAC,EAAE;UAChB,MAAM,IAAID,KAAK,CAAC,IAAAa,mBAAO,CAAC;AAChC,wBAAwB,IAAAC,KAAA,CAAAX,OAAA,EAAMP,MAAM,EAAG,aAAY,EAAG,WAAU,CAAE;AAClE,4CAA4CA,MAAM,CAACE,OAAO,CAACC,EAAG;AAC9D,wEAAwE,CAAC;QACnE;QACA,MAAMgB,GAAG,GAAGtB,KAAK,CAACC,MAAM,CAACsB,MAAM,CAACf,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5CR,KAAK,CAACE,IAAI,CAACgB,IAAI,CAAC;UACd,GAAGI,GAAG;UACNH,WAAW;UACXK,OAAO,EAAE,IAAAC,eAAM,EAACN,WAAW,CAAC,CAACO,IAAI,CAAC,IAAAD,eAAM,EAACH,GAAG,CAACR,SAAS,CAAC;QACzD,CAAC,CAAC;QAEF,OAAOd,KAAK;MACd;EACF;EAEA,OAAOA,KAAK;AACd,CAAC;AAAC2B,OAAA,CAAA5B,WAAA,GAAAA,WAAA"}