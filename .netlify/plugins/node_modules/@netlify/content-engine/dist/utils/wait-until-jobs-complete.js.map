{"version":3,"file":"wait-until-jobs-complete.js","names":["_redux","require","_manager","waitJobsV1","Promise","resolve","onEndJob","store","getState","jobs","active","length","emitter","off","on","waitUntilAllJobsComplete","all","waitUntilAllJobsV2Complete","then","exports","waitJobsByRequest","requestId","_jobs$jobsByRequest$g","_jobs$jobsByRequest$g2","jobsV2","jobDigests","Set","jobsByRequest","get","waitJobsV2"],"sources":["../../src/utils/wait-until-jobs-complete.ts"],"sourcesContent":["import { emitter, store } from \"../redux\";\n\nimport {\n  waitJobs as waitJobsV2,\n  waitUntilAllJobsComplete as waitUntilAllJobsV2Complete,\n} from \"./jobs/manager\";\n\nasync function waitJobsV1(): Promise<void> {\n  return new Promise<void>((resolve) => {\n    const onEndJob = (): void => {\n      if (store.getState().jobs.active.length === 0) {\n        resolve();\n        emitter.off(`END_JOB`, onEndJob);\n      }\n    };\n\n    emitter.on(`END_JOB`, onEndJob);\n    onEndJob();\n  });\n}\n\nexport const waitUntilAllJobsComplete = (): Promise<void> =>\n  Promise.all([waitJobsV1(), waitUntilAllJobsV2Complete()]).then();\n\nexport async function waitJobsByRequest(requestId: string): Promise<void> {\n  const jobs = store.getState().jobsV2;\n  const jobDigests = new Set([\n    ...(jobs.jobsByRequest.get(requestId) ?? []),\n    ...(jobs.jobsByRequest.get(``) ?? []), // wait for jobs without requestId just in case\n  ]);\n  await Promise.all([waitJobsV1(), waitJobsV2(jobDigests)]);\n}\n"],"mappings":";;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAEA,IAAAC,QAAA,GAAAD,OAAA;AAKA,eAAeE,UAAUA,CAAA,EAAkB;EACzC,OAAO,IAAIC,OAAO,CAAQC,OAAO,IAAK;IACpC,MAAMC,QAAQ,GAAGA,CAAA,KAAY;MAC3B,IAAIC,YAAK,CAACC,QAAQ,CAAC,CAAC,CAACC,IAAI,CAACC,MAAM,CAACC,MAAM,KAAK,CAAC,EAAE;QAC7CN,OAAO,CAAC,CAAC;QACTO,cAAO,CAACC,GAAG,CAAE,SAAQ,EAAEP,QAAQ,CAAC;MAClC;IACF,CAAC;IAEDM,cAAO,CAACE,EAAE,CAAE,SAAQ,EAAER,QAAQ,CAAC;IAC/BA,QAAQ,CAAC,CAAC;EACZ,CAAC,CAAC;AACJ;AAEO,MAAMS,wBAAwB,GAAGA,CAAA,KACtCX,OAAO,CAACY,GAAG,CAAC,CAACb,UAAU,CAAC,CAAC,EAAE,IAAAc,iCAA0B,EAAC,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC;AAACC,OAAA,CAAAJ,wBAAA,GAAAA,wBAAA;AAE5D,eAAeK,iBAAiBA,CAACC,SAAiB,EAAiB;EAAA,IAAAC,qBAAA,EAAAC,sBAAA;EACxE,MAAMd,IAAI,GAAGF,YAAK,CAACC,QAAQ,CAAC,CAAC,CAACgB,MAAM;EACpC,MAAMC,UAAU,GAAG,IAAIC,GAAG,CAAC,CACzB,KAAAJ,qBAAA,GAAIb,IAAI,CAACkB,aAAa,CAACC,GAAG,CAACP,SAAS,CAAC,cAAAC,qBAAA,cAAAA,qBAAA,GAAI,EAAE,CAAC,EAC5C,KAAAC,sBAAA,GAAId,IAAI,CAACkB,aAAa,CAACC,GAAG,CAAE,EAAC,CAAC,cAAAL,sBAAA,cAAAA,sBAAA,GAAI,EAAE,CAAC,CAAE;EAAA,CACxC,CAAC;;EACF,MAAMnB,OAAO,CAACY,GAAG,CAAC,CAACb,UAAU,CAAC,CAAC,EAAE,IAAA0B,iBAAU,EAACJ,UAAU,CAAC,CAAC,CAAC;AAC3D"}