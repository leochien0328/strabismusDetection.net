{"version":3,"file":"engine-context.js","names":["_async_hooks","require","asyncLocalStorage","getAsyncLocalStorage","_asyncLocalStorage","AsyncLocalStorage","getEngineContext","getStore","runWithEngineContext","context","fn","run"],"sources":["../../src/utils/engine-context.ts"],"sourcesContent":["import { AsyncLocalStorage } from \"async_hooks\";\n\nexport interface IEngineContext {\n  requestId: string;\n}\n\nlet asyncLocalStorage;\nfunction getAsyncLocalStorage(): AsyncLocalStorage<IEngineContext> {\n  return asyncLocalStorage ?? (asyncLocalStorage = new AsyncLocalStorage());\n}\n\nexport function getEngineContext(): IEngineContext | undefined {\n  return getAsyncLocalStorage().getStore();\n}\n\nexport function runWithEngineContext<T>(\n  context: IEngineContext,\n  fn: (...args: Array<any>) => T,\n): T {\n  // @ts-ignore typings are incorrect, run() returns the result of fn()\n  return getAsyncLocalStorage().run(context, fn);\n}\n"],"mappings":";;;;;AAAA,IAAAA,YAAA,GAAAC,OAAA;AAMA,IAAIC,iBAAiB;AACrB,SAASC,oBAAoBA,CAAA,EAAsC;EAAA,IAAAC,kBAAA;EACjE,QAAAA,kBAAA,GAAOF,iBAAiB,cAAAE,kBAAA,cAAAA,kBAAA,GAAKF,iBAAiB,GAAG,IAAIG,8BAAiB,CAAC,CAAC;AAC1E;AAEO,SAASC,gBAAgBA,CAAA,EAA+B;EAC7D,OAAOH,oBAAoB,CAAC,CAAC,CAACI,QAAQ,CAAC,CAAC;AAC1C;AAEO,SAASC,oBAAoBA,CAClCC,OAAuB,EACvBC,EAA8B,EAC3B;EACH;EACA,OAAOP,oBAAoB,CAAC,CAAC,CAACQ,GAAG,CAACF,OAAO,EAAEC,EAAE,CAAC;AAChD"}