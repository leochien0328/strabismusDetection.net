{"version":3,"file":"nodes.js","names":["_datastore","require","_redux","hasNodeChanged","id","digest","node","getNode","internal","contentDigest","exports","getNodeAndSavePathDependency","console","error","undefined","loadNodeContent","content","plugin","store","getState","flattenedPlugins","find","plug","name","owner","Error","resolve"],"sources":["../../src/utils/nodes.ts"],"sourcesContent":["import { getNode } from \"../datastore\";\nimport { IGatsbyNode } from \"../redux/types\";\nimport { store } from \"../redux\";\n\n/**\n * Determine if node has changed.\n */\nexport const hasNodeChanged = (id: string, digest: string): boolean => {\n  const node = getNode(id);\n  if (!node) {\n    return true;\n  } else {\n    return node.internal.contentDigest !== digest;\n  }\n};\n\n/**\n * Get node and save path dependency.\n */\nexport const getNodeAndSavePathDependency = (\n  id: string,\n): IGatsbyNode | undefined => {\n  const node = getNode(id);\n\n  if (!node) {\n    console.error(\n      `getNodeAndSavePathDependency failed for node id: ${id} as it was not found in cache`,\n    );\n    return undefined;\n  }\n\n  return node;\n};\n\n/**\n * Get content for a node from the plugin that created it.\n */\nexport async function loadNodeContent(node: IGatsbyNode): Promise<string> {\n  if (typeof node.internal.content === `string`) {\n    return node.internal.content;\n  }\n\n  // Load plugin's loader function\n  const plugin = store\n    .getState()\n    .flattenedPlugins.find((plug) => plug.name === node.internal.owner);\n\n  if (!plugin) {\n    throw new Error(\n      `Could not find owner plugin of node for loadNodeContent with owner \\`${node.internal.owner}\\``,\n    );\n  }\n\n  const { loadNodeContent } = require(plugin.resolve);\n\n  if (!loadNodeContent) {\n    throw new Error(\n      `Could not find function loadNodeContent for plugin ${plugin.name}`,\n    );\n  }\n\n  const content = await loadNodeContent(node);\n\n  node.internal.content = content;\n\n  return content;\n}\n"],"mappings":";;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AAEA,IAAAC,MAAA,GAAAD,OAAA;AAEA;AACA;AACA;AACO,MAAME,cAAc,GAAGA,CAACC,EAAU,EAAEC,MAAc,KAAc;EACrE,MAAMC,IAAI,GAAG,IAAAC,kBAAO,EAACH,EAAE,CAAC;EACxB,IAAI,CAACE,IAAI,EAAE;IACT,OAAO,IAAI;EACb,CAAC,MAAM;IACL,OAAOA,IAAI,CAACE,QAAQ,CAACC,aAAa,KAAKJ,MAAM;EAC/C;AACF,CAAC;;AAED;AACA;AACA;AAFAK,OAAA,CAAAP,cAAA,GAAAA,cAAA;AAGO,MAAMQ,4BAA4B,GACvCP,EAAU,IACkB;EAC5B,MAAME,IAAI,GAAG,IAAAC,kBAAO,EAACH,EAAE,CAAC;EAExB,IAAI,CAACE,IAAI,EAAE;IACTM,OAAO,CAACC,KAAK,CACV,oDAAmDT,EAAG,+BACzD,CAAC;IACD,OAAOU,SAAS;EAClB;EAEA,OAAOR,IAAI;AACb,CAAC;;AAED;AACA;AACA;AAFAI,OAAA,CAAAC,4BAAA,GAAAA,4BAAA;AAGO,eAAeI,eAAeA,CAACT,IAAiB,EAAmB;EACxE,IAAI,OAAOA,IAAI,CAACE,QAAQ,CAACQ,OAAO,KAAM,QAAO,EAAE;IAC7C,OAAOV,IAAI,CAACE,QAAQ,CAACQ,OAAO;EAC9B;;EAEA;EACA,MAAMC,MAAM,GAAGC,YAAK,CACjBC,QAAQ,CAAC,CAAC,CACVC,gBAAgB,CAACC,IAAI,CAAEC,IAAI,IAAKA,IAAI,CAACC,IAAI,KAAKjB,IAAI,CAACE,QAAQ,CAACgB,KAAK,CAAC;EAErE,IAAI,CAACP,MAAM,EAAE;IACX,MAAM,IAAIQ,KAAK,CACZ,wEAAuEnB,IAAI,CAACE,QAAQ,CAACgB,KAAM,IAC9F,CAAC;EACH;EAEA,MAAM;IAAET;EAAgB,CAAC,GAAGd,OAAO,CAACgB,MAAM,CAACS,OAAO,CAAC;EAEnD,IAAI,CAACX,eAAe,EAAE;IACpB,MAAM,IAAIU,KAAK,CACZ,sDAAqDR,MAAM,CAACM,IAAK,EACpE,CAAC;EACH;EAEA,MAAMP,OAAO,GAAG,MAAMD,eAAe,CAACT,IAAI,CAAC;EAE3CA,IAAI,CAACE,QAAQ,CAACQ,OAAO,GAAGA,OAAO;EAE/B,OAAOA,OAAO;AAChB"}