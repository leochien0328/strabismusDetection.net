{"version":3,"file":"index.js","names":["_coreUtils","require","_path","_interopRequireDefault","_opentracing","tracerProvider","initTracer","tracerFile","tracer","process","env","GATSBY_OPEN_TRACING_CONFIG_FILE","resolvedPath","slash","path","resolve","create","Tracer","initGlobalTracer","exports","stopTracer","_tracerProvider","stop"],"sources":["../../../src/utils/tracer/index.ts"],"sourcesContent":["import { slash } from \"../../core-utils\";\nimport path from \"path\";\nimport { Tracer, initGlobalTracer } from \"opentracing\";\n\ninterface ITracerProvider {\n  create(): Tracer;\n  stop(): Promise<void>;\n}\n\nlet tracerProvider: ITracerProvider | undefined;\n\n/**\n * tracerFile should be a js file that exports two functions.\n *\n * `create` - Create and return an open-tracing compatible tracer. See\n * https://github.com/opentracing/opentracing-javascript/blob/master/src/tracer.ts\n *\n * `stop` - Run any tracer cleanup required before the node.js process\n * exits\n */\nexport const initTracer = async (tracerFile: string): Promise<Tracer> => {\n  let tracer: Tracer;\n  if (tracerFile) {\n    process.env.GATSBY_OPEN_TRACING_CONFIG_FILE = tracerFile;\n    const resolvedPath = slash(path.resolve(tracerFile));\n    tracerProvider = require(resolvedPath);\n    tracer = await tracerProvider!.create();\n  } else {\n    tracer = new Tracer(); // Noop\n  }\n\n  initGlobalTracer(tracer);\n\n  return tracer;\n};\n\nexport const stopTracer = async (): Promise<void> => {\n  if (tracerProvider?.stop) {\n    await tracerProvider.stop();\n  }\n};\n"],"mappings":";;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AACA,IAAAC,KAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,YAAA,GAAAH,OAAA;AAOA,IAAII,cAA2C;;AAE/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMC,UAAU,GAAG,MAAOC,UAAkB,IAAsB;EACvE,IAAIC,MAAc;EAClB,IAAID,UAAU,EAAE;IACdE,OAAO,CAACC,GAAG,CAACC,+BAA+B,GAAGJ,UAAU;IACxD,MAAMK,YAAY,GAAG,IAAAC,gBAAK,EAACC,aAAI,CAACC,OAAO,CAACR,UAAU,CAAC,CAAC;IACpDF,cAAc,GAAGJ,OAAO,CAACW,YAAY,CAAC;IACtCJ,MAAM,GAAG,MAAMH,cAAc,CAAEW,MAAM,CAAC,CAAC;EACzC,CAAC,MAAM;IACLR,MAAM,GAAG,IAAIS,mBAAM,CAAC,CAAC,CAAC,CAAC;EACzB;;EAEA,IAAAC,6BAAgB,EAACV,MAAM,CAAC;EAExB,OAAOA,MAAM;AACf,CAAC;AAACW,OAAA,CAAAb,UAAA,GAAAA,UAAA;AAEK,MAAMc,UAAU,GAAG,MAAAA,CAAA,KAA2B;EAAA,IAAAC,eAAA;EACnD,KAAAA,eAAA,GAAIhB,cAAc,cAAAgB,eAAA,eAAdA,eAAA,CAAgBC,IAAI,EAAE;IACxB,MAAMjB,cAAc,CAACiB,IAAI,CAAC,CAAC;EAC7B;AACF,CAAC;AAACH,OAAA,CAAAC,UAAA,GAAAA,UAAA"}