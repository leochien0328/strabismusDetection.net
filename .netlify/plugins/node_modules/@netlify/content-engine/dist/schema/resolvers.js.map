{"version":3,"file":"resolvers.js","names":["_path","_interopRequireDefault","require","_normalizePath","_graphql","_reporter","_utils","_getValueAt","_iterable","_utils2","getMaybeResolvedValue","node","field","nodeInterfaceName","pathObjectToPathString","path","fieldPathNeedToResolve","selector","type","getValueAt","getResolvedFields","keepNonMatches","findOne","typeName","findOneResolver","_source","args","context","info","stats","totalRunQuery","nodeModel","query","filter","schema","getType","tracer","findManyPaginated","findManyPaginatedResolver","group","getProjectedField","distinct","max","min","sum","skip","Math","limit","undefined","extendedArgs","totalPluralRunQuery","result","findAll","connectionType","paginate","resultOffset","createDistinctResolver","distinctResolver","source","edges","values","Set","forEach","value","Array","isArray","subValue","add","Date","toISOString","from","sort","createMinResolver","minResolver","Number","MAX_SAFE_INTEGER","isNaN","createMaxResolver","maxResolver","MIN_SAFE_INTEGER","createSumResolver","sumResolver","reduce","prev","createGroupResolver","groupResolver","groupedResults","acc","key","concat","Object","create","keys","fieldValue","entries","push","GatsbyIterable","totalCount","length","results","params","Error","allItems","start","items","slice","pageCount","count","ceil","currentPage","hasPreviousPage","hasNextPage","map","item","i","arr","next","previous","nodes","pageInfo","itemCount","perPage","link","options","by","fieldConfig","linkResolver","resolver","resolve","defaultFieldResolver","fieldValueOrPromise","keepObjects","then","linkResolverValue","returnType","getNullableType","getNamedType","getNodesByIds","ids","id","getNodeById","runQueryArgs","split","reduceRight","obj","in","eq","firstOnly","GraphQLList","linkResolverQueryResult","queryResult","find","fileByPath","fileByPathResolver","parentFileNode","findRootNodeAncestor","internal","queryNodesByPath","relPaths","queryNodeByPath","relPath","absolutePath","normalize","systemPath","dir","fieldName","selectionSet","fieldNodes","getFieldNodeByNameInSelectionSet","isObjectType","isInterfaceType","_field$args","getFields","fieldArg","arg","name","fieldTC","isEnumType","isInputObjectType","fieldNode","_fieldNode$arguments","arguments","kind","Kind","ENUM","enumKey","enumValue","getValue","currentValue","OBJECT","fields","sortPath","join","selections","selection","FRAGMENT_SPREAD","fragmentDef","fragments","INLINE_FRAGMENT","exports","val","property","WARNED_ABOUT_RESOLVERS","badResolverInvocationMessage","missingVar","resolverName","pathToArray","wrappingResolver","wrappedTracingResolver","parent","reporter","warn","activity","time","createResolverActivity","parentType","telemetryResolverTimings","process","hrtime","bigint","endActivity","duration","end","isTracingResolver","defaultResolver"],"sources":["../../src/schema/resolvers.ts"],"sourcesContent":["import systemPath from \"path\";\nimport normalize from \"normalize-path\";\nimport {\n  GraphQLList,\n  GraphQLType,\n  getNullableType,\n  getNamedType,\n  Kind,\n  GraphQLFieldConfig,\n  GraphQLResolveInfo,\n  isObjectType,\n  isInterfaceType,\n  isEnumType,\n  isInputObjectType,\n  SelectionSetNode,\n  SelectionNode,\n  FieldNode,\n} from \"graphql\";\nimport { Path } from \"graphql/jsutils/Path\";\nimport reporter from \"../reporter\";\nimport { pathToArray } from \"../query/utils\";\nimport { getValueAt } from \"../utils/get-value-at\";\nimport {\n  GatsbyResolver,\n  IGatsbyConnection,\n  IGatsbyResolverContext,\n} from \"./type-definitions\";\nimport { IGatsbyNode } from \"../redux/types\";\nimport { IQueryResult } from \"../datastore/types\";\nimport { GatsbyIterable } from \"../datastore/common/iterable\";\nimport {\n  getResolvedFields,\n  fieldPathNeedToResolve,\n  INestedPathStructureNode,\n  pathObjectToPathString,\n} from \"./utils\";\n\ntype ResolvedLink = IGatsbyNode | Array<IGatsbyNode> | null;\n\ntype nestedListOfStrings = Array<string | nestedListOfStrings>;\ntype nestedListOfNodes = Array<IGatsbyNode | nestedListOfNodes>;\n\nexport function getMaybeResolvedValue(\n  node: IGatsbyNode,\n  field: string | INestedPathStructureNode,\n  nodeInterfaceName: string,\n): any {\n  if (typeof field !== `string`) {\n    field = pathObjectToPathString(field).path;\n  }\n\n  if (\n    fieldPathNeedToResolve({\n      selector: field,\n      type: nodeInterfaceName,\n    })\n  ) {\n    return getValueAt(\n      getResolvedFields(node) as Record<string, unknown>,\n      field,\n      { keepNonMatches: false },\n    );\n  } else {\n    return getValueAt(node, field, { keepNonMatches: false });\n  }\n}\n\nexport function findOne<TSource, TArgs>(\n  typeName: string,\n): GatsbyResolver<TSource, TArgs> {\n  return function findOneResolver(_source, args, context, info): any {\n    if (context.stats) {\n      context.stats.totalRunQuery++;\n    }\n    return context.nodeModel.findOne(\n      {\n        query: { filter: args },\n        type: info.schema.getType(typeName),\n        stats: context.stats,\n        tracer: context.tracer,\n      },\n      { path: context.path },\n    );\n  };\n}\n\ntype PaginatedArgs<TArgs> = TArgs & {\n  skip?: number;\n  limit?: number;\n  sort: any;\n};\n\nexport function findManyPaginated<TSource, TArgs>(\n  typeName: string,\n): GatsbyResolver<TSource, PaginatedArgs<TArgs>> {\n  return async function findManyPaginatedResolver(\n    _source,\n    args,\n    context,\n    info,\n  ): Promise<IGatsbyConnection<IGatsbyNode>> {\n    // Peek into selection set and pass on the `field` arg of `group` and\n    // `distinct` which might need to be resolved.\n    const group = getProjectedField(info, `group`);\n    const distinct = getProjectedField(info, `distinct`);\n    const max = getProjectedField(info, `max`);\n    const min = getProjectedField(info, `min`);\n    const sum = getProjectedField(info, `sum`);\n\n    // Apply paddings for pagination\n    // (for previous/next node and also to detect if there is a previous/next page)\n    const skip = typeof args.skip === `number` ? Math.max(0, args.skip - 1) : 0;\n    const limit = typeof args.limit === `number` ? args.limit + 2 : undefined;\n\n    const extendedArgs = {\n      ...args,\n      group: group || [],\n      distinct: distinct || [],\n      max: max || [],\n      min: min || [],\n      sum: sum || [],\n      skip,\n      limit,\n    };\n    // Note: stats are passed to telemetry in src/commands/build.ts\n    if (context.stats) {\n      context.stats.totalRunQuery++;\n      context.stats.totalPluralRunQuery++;\n    }\n    const result = await context.nodeModel.findAll(\n      {\n        query: extendedArgs,\n        type: info.schema.getType(typeName),\n        stats: context.stats,\n        tracer: context.tracer,\n      },\n      { path: context.path, connectionType: typeName },\n    );\n    return paginate(result, {\n      resultOffset: skip,\n      skip: args.skip,\n      limit: args.limit,\n    });\n  };\n}\n\ninterface IFieldConnectionArgs {\n  field: string | INestedPathStructureNode;\n}\n\nexport function createDistinctResolver(\n  nodeInterfaceName: string,\n): GatsbyResolver<IGatsbyConnection<IGatsbyNode>, IFieldConnectionArgs> {\n  return function distinctResolver(source, args): Array<string> {\n    const { field } = args;\n    const { edges } = source;\n\n    const values = new Set<string>();\n    edges.forEach(({ node }) => {\n      const value = getMaybeResolvedValue(node, field, nodeInterfaceName);\n      if (value === null || value === undefined) {\n        return;\n      }\n      if (Array.isArray(value)) {\n        value.forEach((subValue) =>\n          values.add(\n            subValue instanceof Date ? subValue.toISOString() : subValue,\n          ),\n        );\n      } else if (value instanceof Date) {\n        values.add(value.toISOString());\n      } else {\n        values.add(value);\n      }\n    });\n    return Array.from(values).sort();\n  };\n}\n\nexport function createMinResolver(\n  nodeInterfaceName: string,\n): GatsbyResolver<IGatsbyConnection<IGatsbyNode>, IFieldConnectionArgs> {\n  return function minResolver(source, args): number | null {\n    const { field } = args;\n    const { edges } = source;\n\n    let min = Number.MAX_SAFE_INTEGER;\n\n    edges.forEach(({ node }) => {\n      let value = getMaybeResolvedValue(node, field, nodeInterfaceName);\n\n      if (typeof value !== `number`) {\n        value = Number(value);\n      }\n      if (!isNaN(value) && value < min) {\n        min = value;\n      }\n    });\n    if (min === Number.MAX_SAFE_INTEGER) {\n      return null;\n    }\n    return min;\n  };\n}\n\nexport function createMaxResolver(\n  nodeInterfaceName: string,\n): GatsbyResolver<IGatsbyConnection<IGatsbyNode>, IFieldConnectionArgs> {\n  return function maxResolver(source, args): number | null {\n    const { field } = args;\n    const { edges } = source;\n\n    let max = Number.MIN_SAFE_INTEGER;\n\n    edges.forEach(({ node }) => {\n      let value = getMaybeResolvedValue(node, field, nodeInterfaceName);\n      if (typeof value !== `number`) {\n        value = Number(value);\n      }\n      if (!isNaN(value) && value > max) {\n        max = value;\n      }\n    });\n    if (max === Number.MIN_SAFE_INTEGER) {\n      return null;\n    }\n    return max;\n  };\n}\n\nexport function createSumResolver(\n  nodeInterfaceName: string,\n): GatsbyResolver<IGatsbyConnection<IGatsbyNode>, IFieldConnectionArgs> {\n  return function sumResolver(source, args): number | null {\n    const { field } = args;\n    const { edges } = source;\n\n    return edges.reduce<number | null>((prev, { node }) => {\n      let value = getMaybeResolvedValue(node, field, nodeInterfaceName);\n\n      if (typeof value !== `number`) {\n        value = Number(value);\n      }\n      if (!isNaN(value)) {\n        return (prev || 0) + value;\n      }\n      return prev;\n    }, null);\n  };\n}\n\ntype IGatsbyGroupReturnValue<NodeType> = Array<\n  IGatsbyConnection<NodeType> & {\n    field: string;\n    fieldValue: string | undefined;\n  }\n>;\n\nexport function createGroupResolver(\n  nodeInterfaceName: string,\n): GatsbyResolver<\n  IGatsbyConnection<IGatsbyNode>,\n  PaginatedArgs<IFieldConnectionArgs>\n> {\n  return function groupResolver(\n    source,\n    args,\n  ): IGatsbyGroupReturnValue<IGatsbyNode> {\n    const { field } = args;\n    const { edges } = source;\n    const groupedResults: Record<string, Array<IGatsbyNode>> = edges.reduce(\n      (acc, { node }) => {\n        const value = getMaybeResolvedValue(node, field, nodeInterfaceName);\n        const values = Array.isArray(value) ? value : [value];\n        values\n          .filter((value) => value != null)\n          .forEach((value) => {\n            const key = value instanceof Date ? value.toISOString() : value;\n            acc[key] = (acc[key] || []).concat(node);\n          });\n        return acc;\n        // Note: using Object.create on purpose:\n        //   object key may be arbitrary string including reserved words (i.e. `constructor`)\n        //   see: https://github.com/gatsbyjs/gatsby/issues/22508\n      },\n      Object.create(null),\n    );\n\n    return Object.keys(groupedResults)\n      .sort()\n      .reduce(\n        (acc: IGatsbyGroupReturnValue<IGatsbyNode>, fieldValue: string) => {\n          const entries = groupedResults[fieldValue] || [];\n          acc.push({\n            ...paginate(\n              {\n                entries: new GatsbyIterable(entries),\n                totalCount: async () => entries.length,\n              },\n              args,\n            ),\n            field:\n              typeof field === `string`\n                ? field\n                : pathObjectToPathString(field).path,\n            fieldValue,\n          });\n          return acc;\n        },\n        [],\n      );\n  };\n}\n\nexport function paginate(\n  results: IQueryResult,\n  params: { skip?: number; limit?: number; resultOffset?: number },\n): IGatsbyConnection<IGatsbyNode> {\n  const { resultOffset = 0, skip = 0, limit } = params;\n  if (resultOffset > skip) {\n    throw new Error(\"Result offset cannot be greater than `skip` argument\");\n  }\n  const allItems = Array.from(results.entries);\n\n  const start = skip - resultOffset;\n  const items = allItems.slice(start, limit && start + limit);\n\n  const totalCount = results.totalCount;\n  const pageCount = async (): Promise<number> => {\n    const count = await totalCount();\n    return limit\n      ? Math.ceil(skip / limit) + Math.ceil((count - skip) / limit)\n      : skip\n        ? 2\n        : 1;\n  };\n  const currentPage = limit ? Math.ceil(skip / limit) + 1 : skip ? 2 : 1;\n  const hasPreviousPage = currentPage > 1;\n  const hasNextPage = limit ? allItems.length - start > limit : false;\n\n  return {\n    totalCount,\n    edges: items.map((item, i, arr) => {\n      return {\n        node: item,\n        next: arr[i + 1],\n        previous: arr[i - 1],\n      };\n    }),\n    nodes: items,\n    pageInfo: {\n      currentPage,\n      hasPreviousPage,\n      hasNextPage,\n      itemCount: items.length,\n      pageCount,\n      perPage: limit,\n      totalCount,\n    },\n  };\n}\n\nexport function link<TSource, TArgs>(\n  options: {\n    by: string;\n    type?: GraphQLType;\n    from?: string;\n    keepObjects?: boolean;\n  } = {\n    by: `id`,\n  },\n  fieldConfig: GraphQLFieldConfig<\n    TSource,\n    IGatsbyResolverContext<TSource, TArgs>,\n    TArgs\n  >,\n): GatsbyResolver<TSource, TArgs> {\n  // Note: we explicitly make an attempt to prevent using the `async` keyword because often\n  //       it does not return a promise and this makes a significant difference at scale.\n\n  return function linkResolver(\n    source,\n    args,\n    context,\n    info,\n  ): ResolvedLink | Promise<ResolvedLink> {\n    const resolver = fieldConfig.resolve || context.defaultFieldResolver;\n\n    const fieldValueOrPromise = resolver(source, args, context, {\n      ...info,\n      from: options.from || info.from,\n      keepObjects: options.keepObjects,\n    });\n\n    // Note: for this function, at scale, conditional .then is more efficient than generic await\n    if (typeof fieldValueOrPromise?.then === `function`) {\n      return fieldValueOrPromise.then((fieldValue) =>\n        linkResolverValue(fieldValue, args, context, info),\n      );\n    }\n\n    return linkResolverValue(fieldValueOrPromise, args, context, info);\n  };\n\n  function linkResolverValue(\n    fieldValue,\n    args,\n    context,\n    info,\n  ): ResolvedLink | Promise<ResolvedLink> {\n    if (fieldValue == null) {\n      return null;\n    }\n\n    const returnType = getNullableType(options.type || info.returnType);\n    const type = getNamedType(returnType);\n\n    if (options.by === `id`) {\n      if (Array.isArray(fieldValue)) {\n        return context.nodeModel.getNodesByIds(\n          { ids: fieldValue, keepObjects: options.keepObjects, type: type },\n          { path: context.path },\n        );\n      } else {\n        const id =\n          fieldValue?.id || typeof fieldValue === `string`\n            ? fieldValue\n            : undefined;\n\n        return (\n          context.nodeModel.getNodeById(\n            {\n              id,\n              type: type,\n            },\n            { path: context.path },\n          ) || (options.keepObjects ? fieldValue : null)\n        );\n      }\n    }\n\n    // Return early if fieldValue is [] since { in: [] } doesn't make sense\n    if (Array.isArray(fieldValue) && fieldValue.length === 0) {\n      return fieldValue;\n    }\n\n    const runQueryArgs = args as TArgs & { filter: Record<string, any> };\n    runQueryArgs.filter = options.by.split(`.`).reduceRight(\n      (acc: Record<string, any>, key: string) => {\n        const obj = {};\n        obj[key] = acc;\n        return obj;\n      },\n      Array.isArray(fieldValue) ? { in: fieldValue } : { eq: fieldValue },\n    );\n\n    const firstOnly = !(returnType instanceof GraphQLList);\n\n    if (context.stats) {\n      context.stats.totalRunQuery++;\n      if (firstOnly) {\n        context.stats.totalPluralRunQuery++;\n      }\n    }\n\n    if (firstOnly) {\n      return context.nodeModel\n        .findOne(\n          {\n            query: runQueryArgs,\n            type,\n            stats: context.stats,\n            tracer: context.tracer,\n          },\n          { path: context.path },\n        )\n        .then((result) =>\n          linkResolverQueryResult(fieldValue, result, returnType),\n        );\n    }\n\n    return context.nodeModel\n      .findAll(\n        {\n          query: runQueryArgs,\n          type,\n          stats: context.stats,\n          tracer: context.tracer,\n        },\n        { path: context.path },\n      )\n      .then(({ entries }) =>\n        linkResolverQueryResult(fieldValue, Array.from(entries), returnType),\n      );\n  }\n\n  function linkResolverQueryResult(\n    fieldValue,\n    queryResult,\n    returnType,\n  ): IGatsbyNode | Array<IGatsbyNode> {\n    if (\n      returnType instanceof GraphQLList &&\n      Array.isArray(fieldValue) &&\n      Array.isArray(queryResult)\n    ) {\n      return fieldValue.map((value) =>\n        queryResult.find(\n          (obj) =>\n            getValueAt(obj, options.by, { keepNonMatches: false }) === value,\n        ),\n      );\n    } else {\n      return queryResult;\n    }\n  }\n}\n\nexport function fileByPath<TSource, TArgs>(\n  options: {\n    from?: string;\n  } = {},\n  fieldConfig,\n): GatsbyResolver<TSource, TArgs> {\n  return async function fileByPathResolver(\n    source,\n    args,\n    context,\n    info,\n  ): Promise<IGatsbyNode | nestedListOfNodes | null> {\n    const resolver = fieldConfig.resolve || context.defaultFieldResolver;\n    const fieldValue: nestedListOfStrings = await resolver(\n      source,\n      args,\n      context,\n      {\n        ...info,\n        from: options.from || info.from,\n      },\n    );\n\n    if (fieldValue == null) {\n      return null;\n    }\n\n    // Find the File node for this node (we assume the node is something\n    // like markdown which would be a child node of a File node).\n    const parentFileNode = context.nodeModel.findRootNodeAncestor(\n      source,\n      (node) => node.internal && node.internal.type === `File`,\n    );\n\n    async function queryNodesByPath(\n      relPaths: nestedListOfStrings,\n    ): Promise<nestedListOfNodes> {\n      const arr: nestedListOfNodes = [];\n      for (let i = 0; i < relPaths.length; ++i) {\n        arr[i] = await (Array.isArray(relPaths[i])\n          ? queryNodesByPath(relPaths[i] as nestedListOfStrings)\n          : queryNodeByPath(relPaths[i] as string));\n      }\n      return arr;\n    }\n\n    function queryNodeByPath(relPath: string): Promise<IGatsbyNode> {\n      return context.nodeModel.findOne({\n        query: {\n          filter: {\n            absolutePath: {\n              eq: normalize(systemPath.resolve(parentFileNode.dir, relPath)),\n            },\n          },\n        },\n        type: `File`,\n      });\n    }\n\n    if (Array.isArray(fieldValue)) {\n      return queryNodesByPath(fieldValue);\n    } else {\n      return queryNodeByPath(fieldValue);\n    }\n  };\n}\n\nfunction getProjectedField(\n  info: GraphQLResolveInfo,\n  fieldName: string,\n): Array<string> {\n  const selectionSet = info.fieldNodes[0].selectionSet;\n  if (selectionSet) {\n    const fieldNodes = getFieldNodeByNameInSelectionSet(\n      selectionSet,\n      fieldName,\n      info,\n    );\n\n    if (fieldNodes.length === 0) {\n      return [];\n    }\n\n    const returnType = getNullableType(info.returnType);\n\n    if (isObjectType(returnType) || isInterfaceType(returnType)) {\n      const field = returnType.getFields()[fieldName];\n      const fieldArg = field?.args?.find((arg) => arg.name === `field`);\n      if (fieldArg) {\n        const fieldTC = getNullableType(fieldArg.type);\n\n        if (isEnumType(fieldTC) || isInputObjectType(fieldTC)) {\n          return fieldNodes.reduce(\n            (acc: Array<string>, fieldNode: FieldNode) => {\n              const fieldArg = fieldNode.arguments?.find(\n                (arg) => arg.name.value === `field`,\n              );\n              if (isEnumType(fieldTC)) {\n                if (fieldArg?.value.kind === Kind.ENUM) {\n                  const enumKey = fieldArg.value.value;\n                  const enumValue = fieldTC.getValue(enumKey);\n                  if (enumValue) {\n                    acc.push(enumValue.value);\n                  }\n                }\n              } else if (isInputObjectType(fieldTC)) {\n                const path: Array<string> = [];\n                let currentValue = fieldArg?.value;\n                while (currentValue) {\n                  if (currentValue.kind === Kind.OBJECT) {\n                    if (currentValue.fields.length !== 1) {\n                      throw new Error(`Invalid field arg`);\n                    }\n\n                    const fieldArg = currentValue.fields[0];\n                    path.push(fieldArg.name.value);\n                    currentValue = fieldArg.value;\n                  } else {\n                    currentValue = undefined;\n                  }\n                }\n\n                if (path.length > 0) {\n                  const sortPath = path.join(`.`);\n                  acc.push(sortPath);\n                }\n              }\n              return acc;\n            },\n            [],\n          );\n        }\n      }\n    }\n  }\n\n  return [];\n}\n\nfunction getFieldNodeByNameInSelectionSet(\n  selectionSet: SelectionSetNode,\n  fieldName: string,\n  info: GraphQLResolveInfo,\n): Array<FieldNode> {\n  return selectionSet.selections.reduce(\n    (acc: Array<FieldNode>, selection: SelectionNode) => {\n      if (selection.kind === Kind.FRAGMENT_SPREAD) {\n        const fragmentDef = info.fragments[selection.name.value];\n        if (fragmentDef) {\n          return [\n            ...acc,\n            ...getFieldNodeByNameInSelectionSet(\n              fragmentDef.selectionSet,\n              fieldName,\n              info,\n            ),\n          ];\n        }\n      } else if (selection.kind === Kind.INLINE_FRAGMENT) {\n        return [\n          ...acc,\n          ...getFieldNodeByNameInSelectionSet(\n            selection.selectionSet,\n            fieldName,\n            info,\n          ),\n        ];\n      } /* FIELD_NODE */ else {\n        if (selection.name.value === fieldName) {\n          return [...acc, selection];\n        }\n      }\n      return acc;\n    },\n    [],\n  );\n}\n\nexport const defaultFieldResolver: GatsbyResolver<any, any> =\n  function defaultFieldResolver(source, args, context, info) {\n    if (\n      (typeof source == `object` && source !== null) ||\n      typeof source === `function`\n    ) {\n      if (info.from) {\n        const val = getValueAt(source, info.from, {\n          keepNonMatches: info.keepObjects,\n        });\n\n        // if keepNonMatches returned the source object, it didn't find anything\n        if (info.keepObjects && val === source) {\n          return null;\n        }\n\n        return val;\n      }\n      const property = source[info.fieldName];\n\n      if (typeof property === `function`) {\n        return source[info.fieldName](args, context, info);\n      }\n\n      return property;\n    }\n\n    return null;\n  };\n\nlet WARNED_ABOUT_RESOLVERS = false;\nfunction badResolverInvocationMessage(missingVar: string, path?: Path): string {\n  const resolverName = path ? `${pathToArray(path)} ` : ``;\n  return `GraphQL Resolver ${resolverName}got called without \"${missingVar}\" argument. This might cause unexpected errors.\n\nIt's likely that this has happened in a schemaCustomization with manually invoked resolver. If manually invoking resolvers, it's best to invoke them as follows:\n\n  resolve(parent, args, context, info)\n\n`;\n}\n\nexport function wrappingResolver<TSource, TArgs>(\n  resolver: GatsbyResolver<TSource, TArgs>,\n): GatsbyResolver<TSource, TArgs> {\n  // Note: we explicitly make an attempt to prevent using the `async` keyword because often\n  //       it does not return a promise and this makes a significant difference at scale.\n  //       GraphQL will gracefully handle the resolver result of a promise or non-promise.\n\n  if (resolver[`isTracingResolver`]) {\n    return resolver;\n  }\n\n  const wrappedTracingResolver = function wrappedTracingResolver(\n    parent,\n    args,\n    context,\n    info,\n  ): Promise<any> {\n    if (!WARNED_ABOUT_RESOLVERS) {\n      if (!info) {\n        reporter.warn(badResolverInvocationMessage(`info`));\n        WARNED_ABOUT_RESOLVERS = true;\n      } else if (!context) {\n        reporter.warn(badResolverInvocationMessage(`context`, info.path));\n        WARNED_ABOUT_RESOLVERS = true;\n      }\n    }\n\n    let activity;\n    let time;\n    if (context?.tracer) {\n      activity = context.tracer.createResolverActivity(\n        info.path,\n        `${info.parentType.name}.${info.fieldName}`,\n      );\n      activity.start();\n    }\n    if (context?.telemetryResolverTimings) {\n      time = process.hrtime.bigint();\n    }\n\n    const result = resolver(parent, args, context, info);\n\n    if (!activity && !time) {\n      return result;\n    }\n\n    const endActivity = (): void => {\n      if (context?.telemetryResolverTimings) {\n        context.telemetryResolverTimings.push({\n          name: `${info.parentType}.${info.fieldName}`,\n          duration: Number(process.hrtime.bigint() - time) / 1000 / 1000,\n        });\n      }\n      if (activity) {\n        activity.end();\n      }\n    };\n    if (typeof result?.then === `function`) {\n      result.then(endActivity, endActivity);\n    } else {\n      endActivity();\n    }\n    return result;\n  };\n\n  wrappedTracingResolver.isTracingResolver = true;\n\n  return wrappedTracingResolver;\n}\n\nexport const defaultResolver = wrappingResolver(defaultFieldResolver);\n"],"mappings":"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"}