{"version":3,"file":"print.js","names":["fs","_interopRequireWildcard","require","_graphqlCompose","_reporter","_interopRequireDefault","_graphql","_blockString","_extensions","_builtInTypes","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","breakLine","line","maxLen","parts","split","RegExp","length","sublines","i","push","slice","descriptionLines","description","rawLines","_flatMap2","printBlock","items","join","printDeprecated","fieldOrEnumVal","reason","deprecationReason","reasonAST","astFromValue","GraphQLString","DEFAULT_DEPRECATION_REASON","print","printDescription","def","indentation","firstInBlock","isNamedTypeComposer","getDescription","lines","text","isMultiline","blockString","printBlockString","minimize","prefix","replace","printDirectiveArgs","args","directive","directiveArgs","entries","map","name","value","arg","find","type","printDirectives","extensions","directives","internalExtensionNames","includes","exports","printInputValue","inputTC","argDecl","getTypeName","defaultValue","defaultAST","getType","printArgs","argsArray","every","_name","argTC","printFields","fields","printedFields","fieldName","fieldTC","String","printScalarType","tc","printObjectType","interfaces","getInterfaces","implementedInterfaces","getExtensions","getFields","hasInterface","dontInfer","_omit2","schemaComposer","getDirectives","printedDirectives","printInterfaceType","printUnionType","types","getTypeNames","possibleTypes","printEnumType","values","valueTC","printInputObjectType","printType","ObjectTypeComposer","InterfaceTypeComposer","UnionTypeComposer","EnumTypeComposer","ScalarTypeComposer","InputTypeComposer","printTypeDefinitions","config","Promise","resolve","path","include","exclude","withFieldTypes","rewrite","report","error","existsSync","internalPlugins","typesToExclude","pluginsToExclude","plugins","getName","isInternalType","typeName","internalTypeNames","plugin","getExtension","shouldIncludeType","processedTypes","Set","typeDefs","addType","add","addWithFieldTypes","forEach","iface","ifaceName","getAnyTC","getFieldNames","fieldType","getFieldTC","fieldArgs","getFieldArgs","keys","argName","getFieldArgTC","printedTypeDefs","Date","toISOString","info","writeFile"],"sources":["../../src/schema/print.ts"],"sourcesContent":["import * as fs from \"fs-extra\";\nimport {\n  EnumTypeComposer,\n  InputTypeComposer,\n  InterfaceTypeComposer,\n  ObjectTypeComposer,\n  ScalarTypeComposer,\n  UnionTypeComposer,\n  SchemaComposer,\n  NamedTypeComposer,\n  ObjectTypeComposerFieldConfigMap,\n  ObjectTypeComposerFieldConfig,\n  ObjectTypeComposerArgumentConfigMap,\n  ObjectTypeComposerArgumentConfig,\n  Extensions,\n  isNamedTypeComposer,\n  EnumTypeComposerValueConfig,\n} from \"graphql-compose\";\nimport report from \"../reporter\";\nimport {\n  GraphQLDirective,\n  astFromValue,\n  print,\n  GraphQLString,\n  DEFAULT_DEPRECATION_REASON,\n} from \"graphql\";\nimport { printBlockString } from \"graphql/language/blockString\";\nimport { internalExtensionNames } from \"./extensions\";\nimport _ from \"lodash\";\nimport { internalTypeNames } from \"./types/built-in-types\";\n\nexport interface ISchemaPrintConfig {\n  path?: string;\n  include?: {\n    types: Array<string>;\n    plugins: Array<string>;\n  };\n  exclude?: {\n    types: Array<string>;\n    plugins: Array<string>;\n  };\n  withFieldTypes?: boolean;\n  rewrite?: boolean;\n}\n\nconst breakLine = (line: string, maxLen: number): Array<string> => {\n  const parts = line.split(new RegExp(`((?: |^).{15,${maxLen - 40}}(?= |$))`));\n  if (parts.length < 4) {\n    return [line];\n  }\n  const sublines = [parts[0] + parts[1] + parts[2]];\n  for (let i = 3; i < parts.length; i += 2) {\n    sublines.push(parts[i].slice(1) + parts[i + 1]);\n  }\n  return sublines;\n};\n\nconst descriptionLines = (\n  description: string,\n  maxLen: number,\n): Array<string> => {\n  const rawLines = description.split(`\\n`);\n  return _.flatMap(rawLines, (line) => {\n    if (line.length < maxLen + 5) {\n      return line;\n    }\n    // For > 120 character long lines, cut at space boundaries into sublines\n    // of ~80 chars.\n    return breakLine(line, maxLen);\n  });\n};\n\nconst printBlock = (items: Array<string>): string =>\n  items.length !== 0 ? ` {\\n` + items.join(`\\n`) + `\\n}` : ``;\n\nconst printDeprecated = (\n  fieldOrEnumVal:\n    | ObjectTypeComposerFieldConfig<unknown, unknown>\n    | EnumTypeComposerValueConfig,\n): string => {\n  const reason = fieldOrEnumVal.deprecationReason;\n  if (!reason) {\n    return ``;\n  }\n  const reasonAST = astFromValue(reason, GraphQLString);\n  if (reasonAST && reason !== `` && reason !== DEFAULT_DEPRECATION_REASON) {\n    return ` @deprecated(reason: ` + print(reasonAST) + `)`;\n  }\n  return ` @deprecated`;\n};\n\nconst printDescription = (\n  def:\n    | ObjectTypeComposerFieldConfig<unknown, unknown>\n    | NamedTypeComposer<unknown>\n    | ObjectTypeComposerArgumentConfig\n    | EnumTypeComposerValueConfig,\n  indentation = ``,\n  firstInBlock = true,\n): string => {\n  const description = isNamedTypeComposer(def)\n    ? def.getDescription()\n    : def.description;\n  if (!description) {\n    return ``;\n  }\n\n  const lines = descriptionLines(description, 120 - indentation.length);\n\n  const text = lines.join(`\\n`);\n  const isMultiline = text.length > 70;\n  const blockString = printBlockString(text, { minimize: !isMultiline });\n  const prefix =\n    indentation && !firstInBlock ? `\\n` + indentation : indentation;\n\n  return prefix + blockString.replace(/\\n/g, `\\n` + indentation) + `\\n`;\n};\n\nconst printDirectiveArgs = (args: any, directive: GraphQLDirective): string => {\n  if (!args || !directive) {\n    return ``;\n  }\n\n  const directiveArgs = Object.entries(args);\n  if (directiveArgs.length === 0) {\n    return ``;\n  }\n\n  return (\n    `(` +\n    directiveArgs\n      .map(([name, value]) => {\n        const arg =\n          directive.args && directive.args.find((arg) => arg.name === name);\n\n        return arg && `${name}: ${print(astFromValue(value, arg.type)!)}`;\n      })\n      .join(`, `) +\n    `)`\n  );\n};\n\nexport const printDirectives = (\n  extensions: Extensions,\n  directives: Array<GraphQLDirective>,\n): string =>\n  Object.entries(extensions)\n    .map(([name, args]) => {\n      if ([...internalExtensionNames, `deprecated`].includes(name)) return ``;\n      return (\n        ` @${name}` +\n        printDirectiveArgs(\n          args,\n          directives.find((directive) => directive.name === name)!,\n        )\n      );\n    })\n    .join(``);\n\nconst printInputValue = ([name, inputTC]: [\n  string,\n  ObjectTypeComposerArgumentConfig,\n]): string => {\n  let argDecl = name + `: ` + inputTC.type.getTypeName();\n  if (inputTC.defaultValue) {\n    const defaultAST = astFromValue(\n      inputTC.defaultValue,\n      inputTC.type.getType(),\n    );\n    if (defaultAST) {\n      argDecl += ` = ${print(defaultAST)}`;\n    }\n  }\n  return argDecl;\n};\n\nconst printArgs = (\n  args: ObjectTypeComposerArgumentConfigMap | undefined,\n  indentation = ``,\n): string => {\n  if (!args) {\n    return ``;\n  }\n  const argsArray = Object.entries(args);\n  if (argsArray.length === 0) {\n    return ``;\n  }\n\n  // If all args have no description, print them on one line\n  if (argsArray.every(([_name, argTC]) => !argTC.description)) {\n    return `(` + argsArray.map(printInputValue).join(`, `) + `)`;\n  }\n\n  return (\n    `(\\n` +\n    argsArray\n      .map(\n        ([_name, argTC], i) =>\n          printDescription(argTC, `  ` + indentation, !i) +\n          `  ` +\n          indentation +\n          printInputValue([_name, argTC]),\n      )\n      .join(`\\n`) +\n    `\\n` +\n    indentation +\n    `)`\n  );\n};\n\nconst printFields = (\n  fields: ObjectTypeComposerFieldConfigMap<unknown, unknown>,\n  directives: Array<GraphQLDirective>,\n): string => {\n  const printedFields = Object.entries(fields).map(\n    ([fieldName, fieldTC], i) =>\n      printDescription(fieldTC, `  `, !i) +\n      `  ` +\n      fieldName +\n      printArgs(fieldTC.args, `  `) +\n      `: ` +\n      String(fieldTC.type.getTypeName()) +\n      printDirectives(fieldTC.extensions || {}, directives) +\n      printDeprecated(fieldTC),\n  );\n  return printBlock(printedFields);\n};\n\nconst printScalarType = (tc: ScalarTypeComposer): string =>\n  printDescription(tc) + `scalar ${tc.getTypeName()}`;\n\nconst printObjectType = (tc: ObjectTypeComposer<unknown>): string => {\n  const interfaces = tc.getInterfaces();\n  const implementedInterfaces = interfaces.length\n    ? ` implements ` + interfaces.map((i) => i.getTypeName()).join(` & `)\n    : ``;\n  const extensions = tc.getExtensions();\n  let fields = tc.getFields();\n  if (tc.hasInterface(`Node`)) {\n    extensions.dontInfer = null;\n    fields = _.omit(fields, [`id`, `parent`, `children`, `internal`]);\n  }\n  const directives = tc.schemaComposer.getDirectives();\n  const printedDirectives = printDirectives(extensions, directives);\n\n  return (\n    printDescription(tc) +\n    `type ${tc.getTypeName()}${implementedInterfaces}${printedDirectives}` +\n    printFields(fields, directives)\n  );\n};\n\nconst printInterfaceType = (tc: InterfaceTypeComposer<unknown>): string => {\n  const interfaces = tc.getInterfaces();\n  const implementedInterfaces = interfaces.length\n    ? ` implements ` + interfaces.map((i) => i.getTypeName()).join(` & `)\n    : ``;\n  const extensions = tc.getExtensions();\n  const directives = tc.schemaComposer.getDirectives();\n  const printedDirectives = printDirectives(extensions, directives);\n  return (\n    printDescription(tc) +\n    `interface ${tc.getTypeName()}${implementedInterfaces}${printedDirectives}` +\n    printFields(tc.getFields(), directives)\n  );\n};\n\nconst printUnionType = (tc: UnionTypeComposer): string => {\n  const types = tc.getTypeNames();\n  const possibleTypes = types.length ? ` = ` + types.join(` | `) : ``;\n  return printDescription(tc) + `union ` + tc.getTypeName() + possibleTypes;\n};\n\nconst printEnumType = (tc: EnumTypeComposer): string => {\n  const values = Object.entries(tc.getFields()).map(\n    ([name, valueTC], i) =>\n      printDescription(valueTC, `  `, !i) +\n      `  ` +\n      name +\n      printDeprecated(valueTC),\n  );\n\n  return printDescription(tc) + `enum ${tc.getTypeName()}` + printBlock(values);\n};\n\nconst printInputObjectType = (tc: InputTypeComposer): string => {\n  const fields = Object.entries(tc.getFields()).map(\n    ([fieldName, fieldTC], i) =>\n      printDescription(fieldTC, `  `, !i) +\n      `  ` +\n      printInputValue([fieldName, fieldTC]),\n  );\n\n  return (\n    printDescription(tc) + `input ${tc.getTypeName()}` + printBlock(fields)\n  );\n};\n\nconst printType = (tc: NamedTypeComposer<unknown>): string => {\n  if (tc instanceof ObjectTypeComposer) {\n    return printObjectType(tc);\n  } else if (tc instanceof InterfaceTypeComposer) {\n    return printInterfaceType(tc);\n  } else if (tc instanceof UnionTypeComposer) {\n    return printUnionType(tc);\n  } else if (tc instanceof EnumTypeComposer) {\n    return printEnumType(tc);\n  } else if (tc instanceof ScalarTypeComposer) {\n    return printScalarType(tc);\n  } else if (tc instanceof InputTypeComposer) {\n    return printInputObjectType(tc);\n  }\n\n  return ``;\n};\n\nexport const printTypeDefinitions = ({\n  config,\n  schemaComposer,\n}: {\n  config: ISchemaPrintConfig;\n  schemaComposer: SchemaComposer;\n}): Promise<void> => {\n  if (!config) return Promise.resolve();\n\n  const {\n    path,\n    include,\n    exclude,\n    withFieldTypes,\n    rewrite = false,\n  } = config || {};\n\n  if (!path) {\n    report.error(\n      `Printing type definitions aborted. Please provide a file path.`,\n    );\n    return Promise.resolve();\n  }\n\n  if (!rewrite && fs.existsSync(path)) {\n    report.error(\n      `Printing type definitions aborted. The file \\`${path}\\` already exists.`,\n    );\n    return Promise.resolve();\n  }\n  const internalPlugins = [`internal-data-bridge`];\n\n  const typesToExclude = exclude?.types || [];\n  const pluginsToExclude = exclude?.plugins || [];\n\n  const getName = (tc: NamedTypeComposer<unknown>): string => tc.getTypeName();\n\n  const isInternalType = (tc: NamedTypeComposer<unknown>): boolean => {\n    const typeName = getName(tc);\n    if (internalTypeNames.includes(typeName)) {\n      return true;\n    }\n\n    const plugin = tc.getExtension(`plugin`);\n    if (typeof plugin === `string` && internalPlugins.includes(plugin)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  const shouldIncludeType = (tc: NamedTypeComposer<unknown>): boolean => {\n    const typeName = getName(tc);\n    if (typesToExclude.includes(typeName)) {\n      return false;\n    }\n    if (include?.types && !include.types.includes(typeName)) {\n      return false;\n    }\n\n    const plugin = tc.getExtension(`plugin`);\n    if (typeof plugin === `string` && pluginsToExclude.includes(plugin)) {\n      return false;\n    }\n    if (\n      include?.plugins &&\n      (!plugin ||\n        (typeof plugin === `string` && !include.plugins.includes(plugin)))\n    ) {\n      return false;\n    }\n\n    return true;\n  };\n\n  // Save processed type names, not references to the type composers,\n  // because of how graphql-compose, at least in v6, processes\n  // inline types\n  const processedTypes = new Set<string>();\n  const typeDefs = new Set<NamedTypeComposer<unknown>>();\n\n  const addType = (\n    tc: NamedTypeComposer<unknown>,\n  ): null | Set<NamedTypeComposer<unknown>> => {\n    const typeName = getName(tc);\n    if (!processedTypes.has(typeName) && !isInternalType(tc)) {\n      processedTypes.add(typeName);\n      return typeDefs.add(tc);\n    }\n    processedTypes.add(typeName);\n    return null;\n  };\n\n  const addWithFieldTypes = (tc: NamedTypeComposer<unknown>): void => {\n    if (\n      addType(tc) &&\n      (tc instanceof ObjectTypeComposer ||\n        tc instanceof InterfaceTypeComposer ||\n        tc instanceof InputTypeComposer)\n    ) {\n      if (tc instanceof ObjectTypeComposer) {\n        const interfaces = tc.getInterfaces();\n        interfaces.forEach((iface) => {\n          const ifaceName = iface.getTypeName();\n          if (ifaceName !== `Node`) {\n            addWithFieldTypes(schemaComposer.getAnyTC(ifaceName));\n          }\n        });\n      }\n\n      tc.getFieldNames().forEach((fieldName) => {\n        const fieldType = tc.getFieldTC(fieldName);\n        addWithFieldTypes(fieldType);\n\n        if (!(tc instanceof InputTypeComposer)) {\n          const fieldArgs = tc.getFieldArgs(fieldName);\n          Object.keys(fieldArgs).forEach((argName) => {\n            try {\n              addWithFieldTypes(tc.getFieldArgTC(fieldName, argName));\n            } catch {\n              // this type might not exist yet. If it won't be created by the end\n              // of schema creation then building schema will fail and fact that we\n              // skip it here won't matter\n            }\n          });\n        }\n      });\n    }\n  };\n\n  schemaComposer.forEach((tc) => {\n    if (!isInternalType(tc) && shouldIncludeType(tc)) {\n      if (withFieldTypes) {\n        addWithFieldTypes(tc);\n      } else {\n        addType(tc);\n      }\n    }\n  });\n\n  const printedTypeDefs = [\n    `### Type definitions saved at ${new Date().toISOString()} ###`,\n  ];\n\n  try {\n    typeDefs.forEach((tc) => printedTypeDefs.push(printType(tc)));\n    report.info(`Writing GraphQL type definitions to ${path}`);\n    return fs.writeFile(path, printedTypeDefs.join(`\\n\\n`));\n  } catch (error) {\n    report.error(`Failed writing type definitions to \\`${path}\\`.`, error);\n    return Promise.resolve();\n  }\n};\n"],"mappings":"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"}