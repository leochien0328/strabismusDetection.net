{"version":3,"file":"index.js","names":["_redux","require","nodeAPIs","_interopRequireWildcard","_loadInternalPlugins","_validate","_normalize","_getApi","_flattenPlugins","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","loadPlugins","rawConfig","rootDir","config","normalizeConfig","validateConfigPluginsOptions","currentAPIs","getAPI","node","pluginInfos","loadInternalPlugins","pluginArray","flattenPlugins","flattenedPlugins","badExports","collatePluginAPIs","handleBadExports","store","dispatch","type","payload"],"sources":["../../../src/bootstrap/load-plugins/index.ts"],"sourcesContent":["import { store } from \"../../redux\";\nimport { IGatsbyState } from \"../../redux/types\";\nimport * as nodeAPIs from \"../../utils/api-node-docs\";\nimport { loadInternalPlugins } from \"./load-internal-plugins\";\nimport {\n  collatePluginAPIs,\n  handleBadExports,\n  validateConfigPluginsOptions,\n} from \"./validate\";\nimport { IFlattenedPlugin } from \"./types\";\nimport { normalizeConfig } from \"./utils/normalize\";\nimport { getAPI } from \"./utils/get-api\";\nimport { flattenPlugins } from \"./utils/flatten-plugins\";\nimport { IGatsbyConfig } from \"../../internal\";\n\nexport async function loadPlugins(\n  rawConfig: IGatsbyConfig,\n  rootDir: string,\n): Promise<Array<IFlattenedPlugin>> {\n  // Turn all strings in plugins: [`...`] into the { resolve: ``, options: {} } form\n  const config = normalizeConfig(rawConfig);\n\n  // Show errors for invalid plugin configuration\n  await validateConfigPluginsOptions(config, rootDir);\n\n  const currentAPIs = getAPI({\n    node: nodeAPIs,\n  });\n\n  // Collate internal plugins, site config plugins, site default plugins\n  const pluginInfos = loadInternalPlugins(config, rootDir);\n\n  // Create a flattened array of the plugins\n  const pluginArray = flattenPlugins(pluginInfos);\n\n  // Work out which plugins use which APIs, including those which are not\n  // valid Gatsby APIs, aka 'badExports'\n  const { flattenedPlugins, badExports } = await collatePluginAPIs({\n    currentAPIs,\n    flattenedPlugins: pluginArray,\n    rootDir,\n  });\n\n  // Show errors for any non-Gatsby APIs exported from plugins\n  await handleBadExports({ currentAPIs, badExports });\n\n  // If we get this far, everything looks good. Update the store\n  store.dispatch({\n    type: `SET_SITE_FLATTENED_PLUGINS`,\n    payload: flattenedPlugins as IGatsbyState[\"flattenedPlugins\"],\n  });\n\n  return flattenedPlugins;\n}\n"],"mappings":";;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAEA,IAAAC,QAAA,GAAAC,uBAAA,CAAAF,OAAA;AACA,IAAAG,oBAAA,GAAAH,OAAA;AACA,IAAAI,SAAA,GAAAJ,OAAA;AAMA,IAAAK,UAAA,GAAAL,OAAA;AACA,IAAAM,OAAA,GAAAN,OAAA;AACA,IAAAO,eAAA,GAAAP,OAAA;AAAyD,SAAAQ,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAP,wBAAAW,GAAA,EAAAJ,WAAA,SAAAA,WAAA,IAAAI,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAG,KAAA,GAAAR,wBAAA,CAAAC,WAAA,OAAAO,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAJ,GAAA,YAAAG,KAAA,CAAAE,GAAA,CAAAL,GAAA,SAAAM,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAX,GAAA,QAAAW,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAd,GAAA,EAAAW,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAV,GAAA,EAAAW,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAX,GAAA,CAAAW,GAAA,SAAAL,MAAA,CAAAJ,OAAA,GAAAF,GAAA,MAAAG,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAAhB,GAAA,EAAAM,MAAA,YAAAA,MAAA;AAGlD,eAAeW,WAAWA,CAC/BC,SAAwB,EACxBC,OAAe,EACmB;EAClC;EACA,MAAMC,MAAM,GAAG,IAAAC,0BAAe,EAACH,SAAS,CAAC;;EAEzC;EACA,MAAM,IAAAI,sCAA4B,EAACF,MAAM,EAAED,OAAO,CAAC;EAEnD,MAAMI,WAAW,GAAG,IAAAC,cAAM,EAAC;IACzBC,IAAI,EAAErC;EACR,CAAC,CAAC;;EAEF;EACA,MAAMsC,WAAW,GAAG,IAAAC,wCAAmB,EAACP,MAAM,EAAED,OAAO,CAAC;;EAExD;EACA,MAAMS,WAAW,GAAG,IAAAC,8BAAc,EAACH,WAAW,CAAC;;EAE/C;EACA;EACA,MAAM;IAAEI,gBAAgB;IAAEC;EAAW,CAAC,GAAG,MAAM,IAAAC,2BAAiB,EAAC;IAC/DT,WAAW;IACXO,gBAAgB,EAAEF,WAAW;IAC7BT;EACF,CAAC,CAAC;;EAEF;EACA,MAAM,IAAAc,0BAAgB,EAAC;IAAEV,WAAW;IAAEQ;EAAW,CAAC,CAAC;;EAEnD;EACAG,YAAK,CAACC,QAAQ,CAAC;IACbC,IAAI,EAAG,4BAA2B;IAClCC,OAAO,EAAEP;EACX,CAAC,CAAC;EAEF,OAAOA,gBAAgB;AACzB"}