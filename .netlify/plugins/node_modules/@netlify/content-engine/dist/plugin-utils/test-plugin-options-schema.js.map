{"version":3,"file":"test-plugin-options-schema.js","names":["_joi","require","_validate","testPluginOptionsSchema","pluginSchemaFunction","pluginOptions","pluginSchema","Joi","extend","joi","type","base","array","items","alternatives","string","object","resolve","options","unknown","custom","arrayValue","map","value","default","_warning$details$map","_warning$details","warning","validateOptionsSchema","warnings","details","detail","message","length","isValid","errors","hasWarnings","e","_e$details$map","_e$details"],"sources":["../../src/plugin-utils/test-plugin-options-schema.ts"],"sourcesContent":["import { Joi } from \"./joi\";\nimport { GatsbyNode } from \"../types\";\nimport { validateOptionsSchema } from \"./validate\";\nimport { IPluginInfoOptions } from \"./types\";\n\ninterface ITestPluginOptionsSchemaReturnType {\n  errors: Array<string>;\n  warnings: Array<string>;\n  isValid: boolean;\n  hasWarnings: boolean;\n}\n\nexport async function testPluginOptionsSchema(\n  pluginSchemaFunction: Exclude<GatsbyNode[\"pluginOptionsSchema\"], undefined>,\n  pluginOptions: IPluginInfoOptions,\n): Promise<ITestPluginOptionsSchemaReturnType> {\n  const pluginSchema = pluginSchemaFunction({\n    Joi: Joi.extend((joi) => {\n      return {\n        type: `subPlugins`,\n        base: joi\n          .array()\n          .items(\n            joi.alternatives(\n              joi.string(),\n              joi.object({\n                resolve: Joi.string(),\n                options: Joi.object({}).unknown(true),\n              }),\n            ),\n          )\n          .custom(\n            (arrayValue) =>\n              arrayValue.map((value) => {\n                if (typeof value === `string`) {\n                  value = { resolve: value };\n                }\n\n                return value;\n              }),\n            `Gatsby specific subplugin validation`,\n          )\n          .default([]),\n      };\n    }),\n  });\n\n  try {\n    const { warning } = await validateOptionsSchema(\n      pluginSchema,\n      pluginOptions,\n    );\n\n    const warnings = warning?.details?.map((detail) => detail.message) ?? [];\n\n    if (warnings?.length > 0) {\n      return {\n        isValid: true,\n        errors: [],\n        hasWarnings: true,\n        warnings,\n      };\n    }\n  } catch (e) {\n    const errors = e?.details?.map((detail) => detail.message) ?? [];\n    return { isValid: false, errors, hasWarnings: false, warnings: [] };\n  }\n\n  return { isValid: true, errors: [], hasWarnings: false, warnings: [] };\n}\n"],"mappings":";;;;AAAA,IAAAA,IAAA,GAAAC,OAAA;AAEA,IAAAC,SAAA,GAAAD,OAAA;AAUO,eAAeE,uBAAuBA,CAC3CC,oBAA2E,EAC3EC,aAAiC,EACY;EAC7C,MAAMC,YAAY,GAAGF,oBAAoB,CAAC;IACxCG,GAAG,EAAEA,QAAG,CAACC,MAAM,CAAEC,GAAG,IAAK;MACvB,OAAO;QACLC,IAAI,EAAG,YAAW;QAClBC,IAAI,EAAEF,GAAG,CACNG,KAAK,CAAC,CAAC,CACPC,KAAK,CACJJ,GAAG,CAACK,YAAY,CACdL,GAAG,CAACM,MAAM,CAAC,CAAC,EACZN,GAAG,CAACO,MAAM,CAAC;UACTC,OAAO,EAAEV,QAAG,CAACQ,MAAM,CAAC,CAAC;UACrBG,OAAO,EAAEX,QAAG,CAACS,MAAM,CAAC,CAAC,CAAC,CAAC,CAACG,OAAO,CAAC,IAAI;QACtC,CAAC,CACH,CACF,CAAC,CACAC,MAAM,CACJC,UAAU,IACTA,UAAU,CAACC,GAAG,CAAEC,KAAK,IAAK;UACxB,IAAI,OAAOA,KAAK,KAAM,QAAO,EAAE;YAC7BA,KAAK,GAAG;cAAEN,OAAO,EAAEM;YAAM,CAAC;UAC5B;UAEA,OAAOA,KAAK;QACd,CAAC,CAAC,EACH,sCACH,CAAC,CACAC,OAAO,CAAC,EAAE;MACf,CAAC;IACH,CAAC;EACH,CAAC,CAAC;EAEF,IAAI;IAAA,IAAAC,oBAAA,EAAAC,gBAAA;IACF,MAAM;MAAEC;IAAQ,CAAC,GAAG,MAAM,IAAAC,+BAAqB,EAC7CtB,YAAY,EACZD,aACF,CAAC;IAED,MAAMwB,QAAQ,IAAAJ,oBAAA,GAAGE,OAAO,aAAPA,OAAO,wBAAAD,gBAAA,GAAPC,OAAO,CAAEG,OAAO,cAAAJ,gBAAA,uBAAhBA,gBAAA,CAAkBJ,GAAG,CAAES,MAAM,IAAKA,MAAM,CAACC,OAAO,CAAC,cAAAP,oBAAA,cAAAA,oBAAA,GAAI,EAAE;IAExE,IAAI,CAAAI,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEI,MAAM,IAAG,CAAC,EAAE;MACxB,OAAO;QACLC,OAAO,EAAE,IAAI;QACbC,MAAM,EAAE,EAAE;QACVC,WAAW,EAAE,IAAI;QACjBP;MACF,CAAC;IACH;EACF,CAAC,CAAC,OAAOQ,CAAC,EAAE;IAAA,IAAAC,cAAA,EAAAC,UAAA;IACV,MAAMJ,MAAM,IAAAG,cAAA,GAAGD,CAAC,aAADA,CAAC,wBAAAE,UAAA,GAADF,CAAC,CAAEP,OAAO,cAAAS,UAAA,uBAAVA,UAAA,CAAYjB,GAAG,CAAES,MAAM,IAAKA,MAAM,CAACC,OAAO,CAAC,cAAAM,cAAA,cAAAA,cAAA,GAAI,EAAE;IAChE,OAAO;MAAEJ,OAAO,EAAE,KAAK;MAAEC,MAAM;MAAEC,WAAW,EAAE,KAAK;MAAEP,QAAQ,EAAE;IAAG,CAAC;EACrE;EAEA,OAAO;IAAEK,OAAO,EAAE,IAAI;IAAEC,MAAM,EAAE,EAAE;IAAEC,WAAW,EAAE,KAAK;IAAEP,QAAQ,EAAE;EAAG,CAAC;AACxE"}